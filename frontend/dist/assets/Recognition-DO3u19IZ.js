import{_ as C,c as n,a as k,b as s,r as w,t as r,h as v,d as g,w as S,p as z,n as F,m as D,f,g as o}from"./index-BlU5efSE.js";import{P as B}from"./logo-BtVPCAG9.js";import{S as R}from"./Sidebar-C2eUXXSZ.js";import{b as x,u as P}from"./auth-Bm6ta8Sy.js";const N={async recognize(p){const e=new FormData;return e.append("image",p),(await x.post("/recognition",e,{headers:{"Content-Type":"multipart/form-data"}})).data}},T={name:"Recognition",components:{ParticlesBackground:B,Sidebar:R},setup(){const p=P(),e=D(()=>p.user),d=f(null),t=f(""),u=f(null),m=f(!1),c=f(null),b=()=>{var a;(a=d.value)==null||a.click()},_=a=>{const l=a.target.files[0];l&&i(l)},y=a=>{const l=a.dataTransfer.files[0];l&&l.type.startsWith("image/")&&i(l)},i=a=>{if(a.size>3*1024*1024){alert("文件大小不能超过3MB");return}u.value=a;const l=new FileReader;l.onload=I=>{t.value=I.target.result},l.readAsDataURL(a)},h=()=>{t.value="",u.value=null,c.value=null,d.value&&(d.value.value="")};return{user:e,fileInput:d,previewImage:t,recognizing:m,result:c,triggerFileInput:b,handleFileSelect:_,handleDrop:y,cancelUpload:h,startRecognition:async()=>{if(u.value){m.value=!0,c.value=null;try{const a=await N.recognize(u.value);a.success?c.value=a.data:alert("识别失败："+(a.message||"未知错误"))}catch(a){console.error("识别错误:",a),alert("识别失败，请稍后重试")}finally{m.value=!1}}},reIdentify:()=>{h()},getSeverityClass:a=>a==="重度"?"severity-high":a==="中度"?"severity-medium":"severity-low"}}},U={class:"container"},V={class:"main-content"},M={class:"top-nav"},A={class:"top-nav-user"},G={class:"user-info"},j={class:"user-name"},E={class:"user-role"},J={class:"recognition-area"},L={class:"upload-section"},W={key:0,class:"preview-container"},q=["src"],H={key:1,class:"controls"},K=["disabled"],O={key:0,class:"fas fa-spinner fa-spin"},Q={key:1,class:"fas fa-search"},X={class:"result-section"},Y={class:"status-area"},Z={class:"status-content"},$={key:0,class:"status-default"},ss={key:1,class:"status-processing"},es={key:2,class:"status-success"},ts={key:0,class:"result-area"},as={class:"result-card"},is={class:"result-details"},ns={class:"detail-item"},os={class:"detail-value"},ls={class:"detail-item"},rs={class:"detail-value"},ds={class:"progress-container"},cs={class:"detail-item"},us={class:"severity-indicator"},vs={class:"detail-value"},gs={class:"detail-item"},fs={class:"detail-value"},ps={key:1,class:"action-buttons"};function ms(p,e,d,t,u,m){var _,y;const c=w("ParticlesBackground"),b=w("Sidebar");return o(),n("div",U,[k(c),k(b),s("main",V,[s("div",M,[e[8]||(e[8]=s("h2",{class:"top-nav-title"},"图像识别",-1)),s("div",A,[e[7]||(e[7]=s("div",{class:"user-avatar"},[s("i",{class:"fas fa-user"})],-1)),s("div",G,[s("div",j,r(((_=t.user)==null?void 0:_.username)||"管理员"),1),s("div",E,r(((y=t.user)==null?void 0:y.role)||"系统管理员"),1)])])]),s("div",J,[s("section",L,[e[13]||(e[13]=s("h2",{class:"section-title"},[s("i",{class:"fas fa-cloud-arrow-up"}),g(" 上传图像 ")],-1)),s("div",{class:"upload-area",onClick:e[1]||(e[1]=(...i)=>t.triggerFileInput&&t.triggerFileInput(...i)),onDragover:e[2]||(e[2]=S(()=>{},["prevent"])),onDrop:e[3]||(e[3]=S((...i)=>t.handleDrop&&t.handleDrop(...i),["prevent"]))},[e[9]||(e[9]=s("div",{class:"upload-icon"},[s("i",{class:"fas fa-image"})],-1)),e[10]||(e[10]=s("p",{class:"upload-text"},"点击或拖拽图像到此处",-1)),e[11]||(e[11]=s("p",{class:"upload-hint"},"支持 JPG、PNG 格式，最大 3MB 的图像文件",-1)),s("input",{type:"file",ref:"fileInput",onChange:e[0]||(e[0]=(...i)=>t.handleFileSelect&&t.handleFileSelect(...i)),accept:"image/jpeg, image/png",style:{display:"none"}},null,544)],32),t.previewImage?(o(),n("div",W,[s("img",{class:"preview-image",src:t.previewImage,alt:"预览图像"},null,8,q)])):v("",!0),t.previewImage?(o(),n("div",H,[s("button",{class:"btn btn-secondary",onClick:e[4]||(e[4]=(...i)=>t.cancelUpload&&t.cancelUpload(...i))},[...e[12]||(e[12]=[s("i",{class:"fas fa-times"},null,-1),g(" 取消 ",-1)])]),s("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>t.startRecognition&&t.startRecognition(...i)),disabled:t.recognizing},[t.recognizing?(o(),n("i",O)):(o(),n("i",Q)),g(" "+r(t.recognizing?"识别中...":"开始识别"),1)],8,K)])):v("",!0)]),s("section",X,[e[21]||(e[21]=s("h2",{class:"section-title"},[s("i",{class:"fas fa-chart-bar"}),g(" 识别结果 ")],-1)),s("div",Y,[e[14]||(e[14]=s("h3",{class:"status-title"},"识别状态",-1)),s("div",Z,[!t.result&&!t.recognizing?(o(),n("p",$,"等待图像上传...")):t.recognizing?(o(),n("p",ss,"正在识别中...")):t.result?(o(),n("p",es,"识别完成")):v("",!0)])]),t.result?(o(),n("div",ts,[s("div",as,[e[19]||(e[19]=s("div",{class:"result-header"},[s("h3",{class:"result-title"},"病虫害识别结果"),s("span",{class:"result-badge badge-success"},"已完成")],-1)),s("div",is,[s("div",ns,[e[15]||(e[15]=s("span",{class:"detail-label"},"病害类型",-1)),s("span",os,r(t.result.diseaseType),1)]),s("div",ls,[e[16]||(e[16]=s("span",{class:"detail-label"},"置信度",-1)),s("div",null,[s("span",rs,r((t.result.confidence*100).toFixed(1))+"%",1),s("div",ds,[s("div",{class:"progress-bar",style:z({width:t.result.confidence*100+"%"})},null,4)])])]),s("div",cs,[e[17]||(e[17]=s("span",{class:"detail-label"},"严重程度",-1)),s("div",us,[s("div",{class:F(["severity-dot",t.getSeverityClass(t.result.severity)])},null,2),s("span",vs,r(t.result.severity),1)])]),s("div",gs,[e[18]||(e[18]=s("span",{class:"detail-label"},"识别时间",-1)),s("span",fs,r(t.result.identifyTime),1)])])])])):v("",!0),t.result?(o(),n("div",ps,[s("button",{class:"btn btn-secondary",onClick:e[6]||(e[6]=(...i)=>t.reIdentify&&t.reIdentify(...i))},[...e[20]||(e[20]=[s("i",{class:"fas fa-redo"},null,-1),g(" 重新识别 ",-1)])])])):v("",!0)])])])])}const Is=C(T,[["render",ms],["__scopeId","data-v-88804564"]]);export{Is as default};
