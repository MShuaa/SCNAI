import{_ as L,c as f,a as S,b as a,r as R,t as l,i as y,q as h,e as _,d as k,F as D,l as A,f as r,o as M,s as j,x as q,y as G,g as b,n as x}from"./index-BlU5efSE.js";import{b as H,u as J}from"./auth-Bm6ta8Sy.js";import{d as K}from"./dashboard--ArtrLqc.js";import{P as Q}from"./logo-BtVPCAG9.js";import{S as X}from"./Sidebar-C2eUXXSZ.js";const Y={async getData(m={}){return(await H.get("/visualization/data",{params:m})).data}},Z={name:"Visualization",components:{ParticlesBackground:Q,Sidebar:X},setup(){const t=J().user,g=r({timeRange:"30",area:"all",diseaseType:"all",droneId:"all"}),s=r({totalArea:"1,250",healthyRate:"87.5%",warningCount:"42",detectionCount:"364"}),C=r([{date:"2025-11-03",area:"东区",disease:"白粉病",count:15,severity:"中度",status:"已处理"},{date:"2025-11-03",area:"西区",disease:"霜霉病",count:8,severity:"重度",status:"处理中"},{date:"2025-11-02",area:"南区",disease:"蚜虫",count:23,severity:"中度",status:"已处理"},{date:"2025-11-02",area:"北区",disease:"炭疽病",count:6,severity:"重度",status:"已处理"},{date:"2025-11-01",area:"中心区",disease:"病毒病",count:12,severity:"中度",status:"已处理"}]),d=r(1),p=r(3),u=r(null),c=r(null),v=r(null),e=r(null);let i={disease:null,health:null,area:null,efficiency:null};const w=o=>o==="重度"?"badge badge-danger":o==="中度"?"badge badge-warning":"badge badge-success",V=o=>o==="已处理"?"badge badge-success":o==="处理中"?"badge badge-warning":"badge badge-info",P=async()=>{await q();const{Chart:o,registerables:W}=await G(async()=>{const{Chart:n,registerables:O}=await import("./chart-19k6OvwP.js");return{Chart:n,registerables:O}},[]);if(o.register(...W),u.value&&!i.disease){const n=u.value.getContext("2d");i.disease=new o(n,{type:"doughnut",data:{labels:["白粉病","霜霉病","炭疽病","病毒病","蚜虫","其他"],datasets:[{data:[35,25,15,10,12,3],backgroundColor:["#f56565","#f6d34d","#38b2ac","#68d391","#805ad5","#718096"],borderWidth:2,borderColor:"#172a45"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#a8b2d1",font:{size:12},padding:20}}},cutout:"60%"}})}if(c.value&&!i.health){const n=c.value.getContext("2d");i.health=new o(n,{type:"line",data:{labels:["10/27","10/28","10/29","10/30","10/31","11/1","11/2","11/3"],datasets:[{label:"健康度 (%)",data:[92,90,88,85,83,80,85,87],borderColor:"#64ffda",backgroundColor:"rgba(100, 255, 218, 0.1)",borderWidth:2,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"}},y:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"},min:70,max:100}},plugins:{legend:{display:!1}}}})}if(v.value&&!i.area){const n=v.value.getContext("2d");i.area=new o(n,{type:"bar",data:{labels:["东区","西区","南区","北区","中心区"],datasets:[{label:"白粉病",data:[35,28,22,18,15],backgroundColor:"#f56565"},{label:"霜霉病",data:[25,30,18,22,15],backgroundColor:"#f6d34d"},{label:"炭疽病",data:[15,12,18,15,10],backgroundColor:"#38b2ac"},{label:"病毒病",data:[10,8,12,10,15],backgroundColor:"#68d391"},{label:"蚜虫",data:[12,15,20,18,10],backgroundColor:"#805ad5"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"}},y:{stacked:!0,grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"}}},plugins:{legend:{position:"top",labels:{color:"#a8b2d1",font:{size:12},padding:15}}}}})}if(e.value&&!i.efficiency){const n=e.value.getContext("2d");i.efficiency=new o(n,{type:"line",data:{labels:["10/27","10/28","10/29","10/30","10/31","11/1","11/2","11/3"],datasets:[{label:"识别数量",data:[42,38,45,50,47,52,48,55],borderColor:"#64ffda",backgroundColor:"transparent",borderWidth:2,yAxisID:"y"},{label:"识别准确率 (%)",data:[92,93,91,94,95,93,94,96],borderColor:"#f6d34d",backgroundColor:"transparent",borderWidth:2,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"}},y:{type:"linear",display:!0,position:"left",grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a8b2d1"},title:{display:!0,text:"识别数量",color:"#a8b2d1"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{color:"#a8b2d1"},min:80,max:100,title:{display:!0,text:"准确率 (%)",color:"#a8b2d1"}}},plugins:{legend:{position:"top",labels:{color:"#a8b2d1",font:{size:12},padding:15}}}}})}},B=async()=>{try{(await Y.getData(g.value)).success&&T()}catch(o){console.error("筛选失败:",o)}},I=()=>{g.value={timeRange:"30",area:"all",diseaseType:"all",droneId:"all"},P()},T=()=>{},z=()=>{alert("数据导出功能开发中...")},F=o=>{alert(`查看详情: ${o.area} - ${o.disease}`)},U=()=>{d.value>1&&d.value--},E=()=>{d.value<p.value&&d.value++},N=o=>{d.value=o};return M(async()=>{try{const o=await K.getRecords();o.success&&(C.value=o.data),await P()}catch(o){console.error("加载数据失败:",o)}}),j(()=>{Object.values(i).forEach(o=>{o&&o.destroy()})}),{user:t,filters:g,stats:s,records:C,currentPage:d,totalPages:p,diseaseChart:u,healthChart:c,areaChart:v,efficiencyChart:e,getSeverityBadgeClass:w,getStatusBadgeClass:V,applyFilter:B,resetFilter:I,exportData:z,viewDetail:F,prevPage:U,nextPage:E,goToPage:N}}},$={class:"container"},aa={class:"main-content"},ta={class:"top-nav"},sa={class:"top-nav-user"},ea={class:"user-info"},oa={class:"user-name"},la={class:"user-role"},ia={class:"filter-card"},na={class:"filter-body"},ra={class:"filter-row"},da={class:"filter-item"},ca={class:"filter-item"},va={class:"filter-item"},ua={class:"filter-item"},fa={class:"filter-action"},ba={class:"stats-grid"},ga={class:"card stats-card"},pa={class:"stats-info"},ya={class:"stats-value"},ha={class:"card stats-card"},ma={class:"stats-info"},Ca={class:"stats-value"},_a={class:"card stats-card"},ka={class:"stats-info"},xa={class:"stats-value"},wa={class:"card stats-card"},Pa={class:"stats-info"},Sa={class:"stats-value"},Ra={class:"charts-grid"},Da={class:"card"},Aa={class:"chart-container"},Va={ref:"diseaseChart"},Ba={class:"card"},Ia={class:"chart-container"},Ta={ref:"healthChart"},za={class:"charts-grid"},Fa={class:"card"},Ua={class:"chart-container"},Ea={ref:"areaChart"},Na={class:"card"},Wa={class:"chart-container"},Oa={ref:"efficiencyChart"},La={class:"card data-table-card"},Ma={class:"card-header"},ja={class:"card-actions"},qa={class:"table-container"},Ga={class:"data-table"},Ha=["onClick"],Ja={class:"pagination"},Ka=["disabled"],Qa=["onClick"],Xa=["disabled"];function Ya(m,t,g,s,C,d){var c,v;const p=R("ParticlesBackground"),u=R("Sidebar");return b(),f("div",$,[S(p),S(u),a("main",aa,[a("div",ta,[t[10]||(t[10]=a("h2",{class:"top-nav-title"},"数据可视化",-1)),a("div",sa,[t[9]||(t[9]=a("div",{class:"user-avatar"},[a("i",{class:"fas fa-user"})],-1)),a("div",ea,[a("div",oa,l(((c=s.user)==null?void 0:c.username)||"管理员"),1),a("div",la,l(((v=s.user)==null?void 0:v.role)||"系统管理员"),1)])])]),a("div",ia,[t[21]||(t[21]=a("div",{class:"filter-header"},[a("h3",{class:"filter-title"},"数据筛选")],-1)),a("div",na,[a("div",ra,[a("div",da,[t[12]||(t[12]=a("label",{class:"filter-label"},"时间范围",-1)),y(a("select",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>s.filters.timeRange=e)},[...t[11]||(t[11]=[_('<option value="7" data-v-332a77e5>最近7天</option><option value="30" selected data-v-332a77e5>最近30天</option><option value="90" data-v-332a77e5>最近90天</option><option value="180" data-v-332a77e5>最近半年</option><option value="365" data-v-332a77e5>最近一年</option>',5)])],512),[[h,s.filters.timeRange]])]),a("div",ca,[t[14]||(t[14]=a("label",{class:"filter-label"},"区域选择",-1)),y(a("select",{class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>s.filters.area=e)},[...t[13]||(t[13]=[_('<option value="all" data-v-332a77e5>全部区域</option><option value="east" data-v-332a77e5>东区</option><option value="west" data-v-332a77e5>西区</option><option value="south" data-v-332a77e5>南区</option><option value="north" data-v-332a77e5>北区</option><option value="center" data-v-332a77e5>中心区</option>',6)])],512),[[h,s.filters.area]])]),a("div",va,[t[16]||(t[16]=a("label",{class:"filter-label"},"病虫害类型",-1)),y(a("select",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>s.filters.diseaseType=e)},[...t[15]||(t[15]=[_('<option value="all" data-v-332a77e5>全部类型</option><option value="powdery" data-v-332a77e5>白粉病</option><option value="downy" data-v-332a77e5>霜霉病</option><option value="anthracnose" data-v-332a77e5>炭疽病</option><option value="virus" data-v-332a77e5>病毒病</option><option value="aphid" data-v-332a77e5>蚜虫</option>',6)])],512),[[h,s.filters.diseaseType]])]),a("div",ua,[t[18]||(t[18]=a("label",{class:"filter-label"},"无人机编号",-1)),y(a("select",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>s.filters.droneId=e)},[...t[17]||(t[17]=[a("option",{value:"all"},"全部无人机",-1),a("option",{value:"drone001"},"无人机 #001",-1),a("option",{value:"drone002"},"无人机 #002",-1),a("option",{value:"drone003"},"无人机 #003",-1)])],512),[[h,s.filters.droneId]])]),a("div",fa,[a("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...e)=>s.applyFilter&&s.applyFilter(...e))},[...t[19]||(t[19]=[a("i",{class:"fas fa-filter"},null,-1),k(" 应用筛选 ",-1)])]),a("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=(...e)=>s.resetFilter&&s.resetFilter(...e))},[...t[20]||(t[20]=[a("i",{class:"fas fa-redo"},null,-1),k(" 重置 ",-1)])])])])])]),a("div",ba,[a("div",ga,[t[23]||(t[23]=a("div",{class:"stats-icon blue"},[a("i",{class:"fas fa-map-marker-alt"})],-1)),a("div",pa,[a("div",ya,l(s.stats.totalArea||"1,250"),1),t[22]||(t[22]=a("div",{class:"stats-label"},"监测总面积 (亩)",-1))])]),a("div",ha,[t[25]||(t[25]=a("div",{class:"stats-icon green"},[a("i",{class:"fas fa-check-circle"})],-1)),a("div",ma,[a("div",Ca,l(s.stats.healthyRate||"87.5%"),1),t[24]||(t[24]=a("div",{class:"stats-label"},"健康率",-1))])]),a("div",_a,[t[27]||(t[27]=a("div",{class:"stats-icon yellow"},[a("i",{class:"fas fa-exclamation-triangle"})],-1)),a("div",ka,[a("div",xa,l(s.stats.warningCount||"42"),1),t[26]||(t[26]=a("div",{class:"stats-label"},"警告数量",-1))])]),a("div",wa,[t[29]||(t[29]=a("div",{class:"stats-icon red"},[a("i",{class:"fas fa-bug"})],-1)),a("div",Pa,[a("div",Sa,l(s.stats.detectionCount||"364"),1),t[28]||(t[28]=a("div",{class:"stats-label"},"总识别次数",-1))])])]),a("div",Ra,[a("div",Da,[t[30]||(t[30]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"病虫害分布"),a("div",{class:"card-icon"},[a("i",{class:"fas fa-chart-pie"})])],-1)),a("div",Aa,[a("canvas",Va,null,512)])]),a("div",Ba,[t[31]||(t[31]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"健康度趋势"),a("div",{class:"card-icon"},[a("i",{class:"fas fa-chart-line"})])],-1)),a("div",Ia,[a("canvas",Ta,null,512)])])]),a("div",za,[a("div",Fa,[t[32]||(t[32]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"各区域病虫害分布"),a("div",{class:"card-icon"},[a("i",{class:"fas fa-chart-bar"})])],-1)),a("div",Ua,[a("canvas",Ea,null,512)])]),a("div",Na,[t[33]||(t[33]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"识别效率统计"),a("div",{class:"card-icon"},[a("i",{class:"fas fa-chart-line"})])],-1)),a("div",Wa,[a("canvas",Oa,null,512)])])]),a("div",La,[a("div",Ma,[t[35]||(t[35]=a("h3",{class:"card-title"},"详细数据记录",-1)),a("div",ja,[a("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=(...e)=>s.exportData&&s.exportData(...e))},[...t[34]||(t[34]=[a("i",{class:"fas fa-download"},null,-1),k(" 导出数据 ",-1)])])])]),a("div",qa,[a("table",Ga,[t[36]||(t[36]=a("thead",null,[a("tr",null,[a("th",null,"日期"),a("th",null,"区域"),a("th",null,"病虫害类型"),a("th",null,"识别数量"),a("th",null,"严重程度"),a("th",null,"处理状态"),a("th",null,"操作")])],-1)),a("tbody",null,[(b(!0),f(D,null,A(s.records,(e,i)=>(b(),f("tr",{key:i},[a("td",null,l(e.date),1),a("td",null,l(e.area),1),a("td",null,l(e.disease),1),a("td",null,l(e.count),1),a("td",null,[a("span",{class:x(s.getSeverityBadgeClass(e.severity))},l(e.severity),3)]),a("td",null,[a("span",{class:x(s.getStatusBadgeClass(e.status))},l(e.status),3)]),a("td",null,[a("button",{class:"btn btn-secondary btn-sm",onClick:w=>s.viewDetail(e)},"查看详情",8,Ha)])]))),128))])])]),a("div",Ja,[a("button",{class:"pagination-btn",onClick:t[7]||(t[7]=(...e)=>s.prevPage&&s.prevPage(...e)),disabled:s.currentPage===1},[...t[37]||(t[37]=[a("i",{class:"fas fa-chevron-left"},null,-1)])],8,Ka),(b(!0),f(D,null,A(s.totalPages,e=>(b(),f("button",{key:e,class:x(["pagination-btn",{active:e===s.currentPage}]),onClick:i=>s.goToPage(e)},l(e),11,Qa))),128)),a("button",{class:"pagination-btn",onClick:t[8]||(t[8]=(...e)=>s.nextPage&&s.nextPage(...e)),disabled:s.currentPage===s.totalPages},[...t[38]||(t[38]=[a("i",{class:"fas fa-chevron-right"},null,-1)])],8,Xa)])])])])}const et=L(Z,[["render",Ya],["__scopeId","data-v-332a77e5"]]);export{et as default};
