# SCNAIæ¤é‰´ç³»ç»Ÿ - å‰åç«¯å¼€å‘æ¥å£æ–‡æ¡£

> **é¡¹ç›®åç§°**: SCNAIæ¤é‰´ (æ¤ç‰©ç—…è™«å®³æ™ºèƒ½è¯†åˆ«ç³»ç»Ÿ)
> **å‰ç«¯æŠ€æœ¯æ ˆ**: Vue 3 + Vue Router + Axios + Chart.js
> **åç«¯æŠ€æœ¯æ ˆ**: Java + Spring Boot
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **ç”Ÿæˆæ—¥æœŸ**: 2024-01-16

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½åˆ—è¡¨ä¸èŒè´£åˆ’åˆ†](#ä¸€åŠŸèƒ½åˆ—è¡¨ä¸èŒè´£åˆ’åˆ†)
2. [æ¥å£å®šä¹‰ä¸è§„èŒƒ](#äºŒæ¥å£å®šä¹‰ä¸è§„èŒƒ)
3. [æ ¸å¿ƒæ•°æ®ç»“æ„](#ä¸‰æ ¸å¿ƒæ•°æ®ç»“æ„)
4. [å¾…ç¡®è®¤ä¸æ³¨æ„äº‹é¡¹](#å››å¾…ç¡®è®¤ä¸æ³¨æ„äº‹é¡¹)

---

## ä¸€ã€åŠŸèƒ½åˆ—è¡¨ä¸èŒè´£åˆ’åˆ†

### 1.1 åŠŸèƒ½æ¨¡å—æ€»è§ˆ

| æ¨¡å—ç¼–å· | åŠŸèƒ½æ¨¡å— | é¡µé¢è·¯ç”± | å‰ç«¯èŒè´£ | åç«¯èŒè´£ |
|---------|---------|---------|---------|---------|
| **M01** | ç”¨æˆ·è®¤è¯ | `/login` | ç™»å½•è¡¨å•éªŒè¯ã€Tokenå­˜å‚¨ã€è·¯ç”±å®ˆå« | ç”¨æˆ·éªŒè¯ã€JWTç”Ÿæˆã€ä¼šè¯ç®¡ç† |
| **M02** | é¦–é¡µ | `/` | å±•ç¤ºç³»ç»Ÿä»‹ç»ã€åŠŸèƒ½å¡ç‰‡ã€å¯¼èˆª | æ— ï¼ˆçº¯é™æ€å±•ç¤ºï¼‰ |
| **M03** | ä»ªè¡¨æ¿ | `/dashboard` | å±•ç¤ºæ— äººæœºçŠ¶æ€ã€å¤©æ°”ã€æ´»åŠ¨æ—¥å¿—ã€æ•°æ®è¡¨æ ¼ | æä¾›ç»Ÿè®¡æ•°æ®ã€æ´»åŠ¨è®°å½•ã€è¯†åˆ«è®°å½•åˆ—è¡¨ |
| **M04** | å›¾åƒè¯†åˆ« | `/recognition` | å›¾åƒä¸Šä¼ ã€é¢„è§ˆã€è°ƒç”¨è¯†åˆ«æ¥å£ã€ç»“æœå±•ç¤º | æ¥æ”¶å›¾åƒã€AIè¯†åˆ«å¤„ç†ã€è¿”å›ç»“æœ |
| **M05** | æ•°æ®å¯è§†åŒ– | `/visualization` | ç­›é€‰æ¡ä»¶ã€Chart.jså›¾è¡¨æ¸²æŸ“ã€æ•°æ®å¯¼å‡º | æ ¹æ®ç­›é€‰æ¡ä»¶èšåˆæ•°æ®ã€è¿”å›å›¾è¡¨æ•°æ® |
| **M06** | æ™ºèƒ½é—®ç­” | `/chat` | æ¶ˆæ¯å‘é€ã€SSEæµå¼æ¥æ”¶ã€æ¶ˆæ¯åˆ—è¡¨å±•ç¤º | LLMè°ƒç”¨ã€æµå¼å“åº”ã€å¯¹è¯å†å²å­˜å‚¨ |
| **M07** | ä¸ªäººä¿¡æ¯ | `/profile` | ç”¨æˆ·ä¿¡æ¯å±•ç¤ºä¸ç¼–è¾‘ã€å¯†ç ä¿®æ”¹ | ç”¨æˆ·ä¿¡æ¯æ›´æ–°ã€å¯†ç éªŒè¯ä¸ä¿®æ”¹ |

---

### 1.2 å„æ¨¡å—è¯¦ç»†èŒè´£

#### M01 - ç”¨æˆ·è®¤è¯æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… æ¸²æŸ“ç™»å½•è¡¨å•ï¼ˆç”¨æˆ·åã€å¯†ç ã€è®°ä½æˆ‘ï¼‰
- âœ… è¡¨å•éªŒè¯ï¼ˆéç©ºã€é•¿åº¦æ£€æŸ¥ï¼‰
- âœ… è°ƒç”¨ç™»å½•æ¥å£ï¼Œå¤„ç†loadingçŠ¶æ€
- âœ… æ¥æ”¶Tokenåå­˜å‚¨åˆ°`localStorage.token`
- âœ… å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°`localStorage.user`
- âœ… è®¾ç½®Axiosé»˜è®¤è¯·æ±‚å¤´`Authorization: Bearer {token}`
- âœ… è·¯ç”±å®ˆå«ï¼šæ£€æŸ¥Tokenæœ‰æ•ˆæ€§ï¼Œæ— Tokené‡å®šå‘åˆ°ç™»å½•é¡µ
- âœ… ç™»å‡ºæ—¶æ¸…é™¤æœ¬åœ°å­˜å‚¨ï¼Œè°ƒç”¨ç™»å‡ºæ¥å£

**åç«¯èŒè´£**:
- âœ… æ¥æ”¶ç”¨æˆ·åå’Œå¯†ç 
- âœ… éªŒè¯ç”¨æˆ·å‡­è¯ï¼ˆæ•°æ®åº“æŸ¥è¯¢ã€å¯†ç bcryptéªŒè¯ï¼‰
- âœ… ç”ŸæˆJWT Tokenï¼ˆæœ‰æ•ˆæœŸæ ¹æ®rememberå‚æ•°ï¼š7å¤©æˆ–1å¤©ï¼‰
- âœ… è¿”å›Tokenå’Œç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆusername, roleï¼‰
- âœ… è®°å½•ç™»å½•æ—¥å¿—ï¼ˆIPã€æ—¶é—´ã€User-Agentï¼‰
- âœ… æä¾›TokenéªŒè¯æ¥å£ï¼ˆç”¨äºå‰ç«¯éªŒè¯Tokenæœ‰æ•ˆæ€§ï¼‰
- âœ… å¤„ç†ç™»å‡ºé€»è¾‘ï¼ˆå¯é€‰ï¼šTokené»‘åå•æœºåˆ¶ï¼‰

---

#### M02 - é¦–é¡µæ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… å±•ç¤ºç³»ç»ŸLogoå’Œæ ‡é¢˜
- âœ… æ¸²æŸ“4ä¸ªåŠŸèƒ½ç‰¹è‰²å¡ç‰‡ï¼ˆæ— äººæœºå·¡æ£€ã€AIè¯†åˆ«ã€æ•°æ®å¯è§†åŒ–ã€æ™ºèƒ½é—®ç­”ï¼‰
- âœ… ç²’å­èƒŒæ™¯åŠ¨ç”»ï¼ˆCanvaså®ç°ï¼‰
- âœ… ç™»å½•æŒ‰é’®å¯¼èˆª

**åç«¯èŒè´£**:
- æ— ï¼ˆçº¯é™æ€é¡µé¢ï¼‰

---

#### M03 - ä»ªè¡¨æ¿æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… é¡µé¢åŠ è½½æ—¶å¹¶è¡Œè°ƒç”¨3ä¸ªæ¥å£ï¼š`/dashboard/stats`ã€`/dashboard/activities`ã€`/dashboard/records`
- âœ… å±•ç¤ºæ— äººæœºçŠ¶æ€å¡ç‰‡ï¼ˆçŠ¶æ€ã€ç”µé‡ã€èˆªç¨‹ã€ç»­èˆªï¼‰
- âœ… å±•ç¤ºå¤©æ°”ä¿¡æ¯å¡ç‰‡ï¼ˆæ¸©åº¦ã€æè¿°ã€æ¹¿åº¦ã€é£é€Ÿã€æ°”å‹ã€7å¤©é¢„æŠ¥ï¼‰
- âœ… å±•ç¤ºæœ€è¿‘æ´»åŠ¨åˆ—è¡¨ï¼ˆç±»å‹ã€åŠ¨ä½œã€æ—¶é—´ï¼‰
- âœ… å±•ç¤ºç—…è™«å®³è¯†åˆ«è®°å½•è¡¨æ ¼ï¼ˆæ—¥æœŸã€åŒºåŸŸã€ç—…è™«å®³ã€æ•°é‡ã€ä¸¥é‡ç¨‹åº¦ã€çŠ¶æ€ï¼‰
- âœ… æä¾›å¯¼å‡ºæ•°æ®åŠŸèƒ½ï¼ˆå‰ç«¯ç”ŸæˆCSVæˆ–è°ƒç”¨åç«¯å¯¼å‡ºæ¥å£ï¼‰

**åç«¯èŒè´£**:
- âœ… æä¾›æ— äººæœºå®æ—¶çŠ¶æ€ï¼ˆä»`drone_status`è¡¨æŸ¥è¯¢æœ€æ–°è®°å½•ï¼‰
- âœ… æä¾›å¤©æ°”æ•°æ®ï¼ˆå®æ—¶å¤©æ°” + 7å¤©é¢„æŠ¥ï¼Œå¯è°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼‰
- âœ… æä¾›ç”¨æˆ·æœ€è¿‘æ´»åŠ¨è®°å½•ï¼ˆä»`activity_logs`è¡¨æŸ¥è¯¢ï¼ŒæŒ‰æ—¶é—´å€’åºï¼Œé™åˆ¶10æ¡ï¼‰
- âœ… æä¾›ç—…è™«å®³è¯†åˆ«è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µæŸ¥è¯¢`recognition_records`è¡¨ï¼ŒæŒ‰æ—¥æœŸå’ŒåŒºåŸŸèšåˆï¼‰
- âœ… ç»Ÿè®¡æ•°æ®ï¼šæ€»è¯†åˆ«æ•°ã€å„ç—…å®³æ•°é‡ã€ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ

---

#### M04 - å›¾åƒè¯†åˆ«æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… æä¾›å›¾åƒä¸Šä¼ åŒºåŸŸï¼ˆç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½ä¸Šä¼ ï¼‰
- âœ… æ–‡ä»¶éªŒè¯ï¼šæ ¼å¼ï¼ˆJPG/PNGï¼‰ã€å¤§å°ï¼ˆæœ€å¤§3MBï¼‰
- âœ… å›¾åƒé¢„è§ˆï¼ˆä½¿ç”¨`FileReader`è¯»å–å¹¶æ˜¾ç¤ºï¼‰
- âœ… è°ƒç”¨è¯†åˆ«æ¥å£ï¼Œä½¿ç”¨`FormData`ä¸Šä¼ å›¾åƒ
- âœ… æ˜¾ç¤ºè¯†åˆ«ä¸­çš„loadingåŠ¨ç”»
- âœ… ç»“æœå±•ç¤ºï¼šç—…å®³ç±»å‹ã€ç½®ä¿¡åº¦ï¼ˆè¿›åº¦æ¡ï¼‰ã€ä¸¥é‡ç¨‹åº¦ã€è¯†åˆ«æ—¶é—´
- âœ… æä¾›"é‡æ–°è¯†åˆ«"å’Œ"å–æ¶ˆ"æ“ä½œ
- âœ… è¯†åˆ«åå°†ç»“æœè®°å½•æ·»åŠ åˆ°å†å²åˆ—è¡¨

**åç«¯èŒè´£**:
- âœ… æ¥æ”¶`multipart/form-data`æ ¼å¼çš„å›¾åƒæ–‡ä»¶
- âœ… éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
- âœ… ä¿å­˜å›¾åƒåˆ°æ–‡ä»¶ç³»ç»Ÿæˆ–äº‘å­˜å‚¨ï¼ˆç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼‰
- âœ… è°ƒç”¨AIæ¨¡å‹è¿›è¡Œç—…è™«å®³è¯†åˆ«
- âœ… è¿”å›è¯†åˆ«ç»“æœï¼šç—…å®³ç±»å‹ã€ç½®ä¿¡åº¦ã€ä¸¥é‡ç¨‹åº¦ã€è¯†åˆ«æ—¶é—´ã€å›¾åƒURL
- âœ… å°†è¯†åˆ«è®°å½•ä¿å­˜åˆ°`recognition_records`è¡¨
- âœ… è®°å½•æ´»åŠ¨æ—¥å¿—åˆ°`activity_logs`è¡¨
- âœ… é”™è¯¯å¤„ç†ï¼šæ–‡ä»¶æ ¼å¼ä¸æ”¯æŒã€æ¨¡å‹æ¨ç†å¤±è´¥ç­‰

---

#### M05 - æ•°æ®å¯è§†åŒ–æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… æ¸²æŸ“ç­›é€‰æ¡ä»¶è¡¨å•ï¼šæ—¶é—´èŒƒå›´ï¼ˆ7/30/90/180/365å¤©ï¼‰ã€åŒºåŸŸã€ç—…è™«å®³ç±»å‹ã€æ— äººæœºç¼–å·
- âœ… ç‚¹å‡»"åº”ç”¨ç­›é€‰"è°ƒç”¨æ¥å£è·å–æ•°æ®
- âœ… ä½¿ç”¨Chart.jsæ¸²æŸ“5ä¸ªå›¾è¡¨ï¼š
  1. **ç—…è™«å®³åˆ†å¸ƒ** - ç”œç”œåœˆå›¾ï¼ˆDoughnutï¼‰
  2. **å¥åº·åº¦è¶‹åŠ¿** - æŠ˜çº¿å›¾ï¼ˆLineï¼‰
  3. **å„åŒºåŸŸç—…è™«å®³åˆ†å¸ƒ** - å †ç§¯æŸ±çŠ¶å›¾ï¼ˆStacked Barï¼‰
  4. **è¯†åˆ«æ•ˆç‡ç»Ÿè®¡** - åŒYè½´æŠ˜çº¿å›¾ï¼ˆMixed Chartï¼‰
  5. **æ•°æ®è¡¨æ ¼** - è¯¦ç»†è¯†åˆ«è®°å½•ï¼ˆåˆ†é¡µï¼‰
- âœ… å±•ç¤ºç»Ÿè®¡å¡ç‰‡ï¼šç›‘æµ‹é¢ç§¯ã€å¥åº·ç‡ã€è­¦å‘Šæ•°é‡ã€æ€»è¯†åˆ«æ¬¡æ•°
- âœ… æä¾›å¯¼å‡ºåŠŸèƒ½ï¼ˆå¯¼å‡ºå›¾è¡¨ä¸ºå›¾ç‰‡æˆ–å¯¼å‡ºæ•°æ®ä¸ºExcelï¼‰

**åç«¯èŒè´£**:
- âœ… æ¥æ”¶ç­›é€‰å‚æ•°ï¼ˆtimeRange, area, diseaseType, droneIdï¼‰
- âœ… æ ¹æ®æ¡ä»¶æŸ¥è¯¢`recognition_records`è¡¨
- âœ… è®¡ç®—æ±‡æ€»ç»Ÿè®¡ï¼š
  - `totalArea`: ç›‘æµ‹æ€»é¢ç§¯ï¼ˆé…ç½®å€¼æˆ–è®¡ç®—å€¼ï¼‰
  - `healthRate`: å¥åº·ç‡ = (æ€»è¯†åˆ«æ•° - ç—…å®³æ•°) / æ€»è¯†åˆ«æ•° Ã— 100
  - `warningCount`: ä¸¥é‡ç¨‹åº¦ä¸º"é‡åº¦"çš„è®°å½•æ•°
  - `totalRecognitions`: æ€»è¯†åˆ«æ¬¡æ•°
- âœ… èšåˆç—…è™«å®³åˆ†å¸ƒæ•°æ®ï¼ˆæŒ‰disease_typeåˆ†ç»„ç»Ÿè®¡ï¼‰
- âœ… èšåˆå¥åº·åº¦è¶‹åŠ¿æ•°æ®ï¼ˆæŒ‰æ—¥æœŸç»Ÿè®¡å¥åº·ç‡ï¼‰
- âœ… èšåˆå„åŒºåŸŸåˆ†å¸ƒæ•°æ®ï¼ˆæŒ‰areaå’Œdateåˆ†ç»„ï¼‰
- âœ… ç»Ÿè®¡è¯†åˆ«æ•ˆç‡æ•°æ®ï¼ˆæ¯æ—¥è¯†åˆ«æ¬¡æ•°ã€å¹³å‡ç½®ä¿¡åº¦ï¼‰
- âœ… è¿”å›è¯¦ç»†è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼Œé»˜è®¤10æ¡/é¡µï¼‰

---

#### M06 - æ™ºèƒ½é—®ç­”æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… æ¸²æŸ“èŠå¤©ç•Œé¢ï¼ˆæ¶ˆæ¯åˆ—è¡¨ + è¾“å…¥æ¡†ï¼‰
- âœ… å±•ç¤ºå¿«æ·å»ºè®®æŒ‰é’®ï¼ˆé¢„å®šä¹‰å¸¸è§é—®é¢˜ï¼‰
- âœ… å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨æµå¼æ¥å£`/chat/stream`
- âœ… ä½¿ç”¨Fetch APIå¤„ç†Server-Sent Eventsï¼ˆSSEï¼‰
- âœ… å®æ—¶æ¥æ”¶å¹¶æ¸²æŸ“AIå›å¤å†…å®¹ï¼ˆé€å­—æ˜¾ç¤ºæ‰“å­—æœºæ•ˆæœï¼‰
- âœ… å¤„ç†3ç§SSEäº‹ä»¶ï¼š
  - `chunk`: æ¥æ”¶å•ä¸ªæ–‡æœ¬å—ï¼Œè¿½åŠ åˆ°æ¶ˆæ¯
  - `complete`: å®Œæ•´å›å¤ç»“æŸ
  - `error`: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- âœ… æ¶ˆæ¯æ ¼å¼åŒ–ï¼šè¯†åˆ«å°æ ‡é¢˜ã€åˆ†ç‚¹åˆ—è¡¨ã€æ®µè½
- âœ… æä¾›å¤åˆ¶æ¶ˆæ¯åŠŸèƒ½
- âœ… è¾“å…¥æ¡†æ”¯æŒEnterå‘é€ã€Shift+Enteræ¢è¡Œ

**åç«¯èŒè´£**:
- âœ… æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯å’Œå¯¹è¯å†å²ï¼ˆhistoryæ•°ç»„ï¼‰
- âœ… è°ƒç”¨LLM APIï¼ˆOpenAI/DeepSeekç­‰ï¼‰
- âœ… ä½¿ç”¨Server-Sent Eventsï¼ˆSSEï¼‰æµå¼è¿”å›å†…å®¹
- âœ… å‘é€3ç§äº‹ä»¶ç±»å‹ï¼š
  - `data: {"type": "chunk", "content": "æ–‡æœ¬å—"}`
  - `data: {"type": "complete", "fullContent": "å®Œæ•´å†…å®¹"}`
  - `data: {"type": "error", "error": "é”™è¯¯ä¿¡æ¯"}`
- âœ… ä¿å­˜å¯¹è¯å†å²åˆ°`chat_history`è¡¨
- âœ… è®°å½•æ´»åŠ¨æ—¥å¿—
- âœ… é”™è¯¯å¤„ç†ï¼šLLMæœåŠ¡ä¸å¯ç”¨ã€è¶…æ—¶ç­‰

---

#### M07 - ä¸ªäººä¿¡æ¯æ¨¡å—

**å‰ç«¯èŒè´£**:
- âœ… å±•ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€è§’è‰²ã€é‚®ç®±ã€æ‰‹æœºï¼‰
- âœ… æä¾›ä¿¡æ¯ç¼–è¾‘è¡¨å•ï¼ˆé‚®ç®±ã€æ‰‹æœºã€çœŸå®å§“åï¼‰
- âœ… æä¾›å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼ˆæ—§å¯†ç ã€æ–°å¯†ç ã€ç¡®è®¤å¯†ç ï¼‰
- âœ… è¡¨å•éªŒè¯ï¼ˆé‚®ç®±æ ¼å¼ã€æ‰‹æœºæ ¼å¼ã€å¯†ç å¼ºåº¦ï¼‰
- âœ… è°ƒç”¨æ›´æ–°æ¥å£å¹¶æ˜¾ç¤ºæ“ä½œç»“æœ

**åç«¯èŒè´£**:
- âœ… æä¾›ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢æ¥å£
- âœ… æä¾›ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ¥å£ï¼ˆéªŒè¯æƒé™ï¼šåªèƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ï¼‰
- âœ… æä¾›å¯†ç ä¿®æ”¹æ¥å£ï¼š
  - éªŒè¯æ—§å¯†ç 
  - éªŒè¯æ–°å¯†ç å¼ºåº¦ï¼ˆè‡³å°‘6ä½ï¼‰
  - ä½¿ç”¨bcryptåŠ å¯†æ–°å¯†ç 
  - æ›´æ–°æ•°æ®åº“
- âœ… è®°å½•ä¿®æ”¹æ—¥å¿—

---

## äºŒã€æ¥å£å®šä¹‰ä¸è§„èŒƒ

### 2.0 é€šç”¨è§„èŒƒ

#### 2.0.1 åŸºç¡€é…ç½®

```
Base URL: http://localhost:5000/api
Content-Type: application/json (é™¤æ–‡ä»¶ä¸Šä¼ å¤–)
Authorization: Bearer {token} (éœ€è¦è®¤è¯çš„æ¥å£)
è¶…æ—¶æ—¶é—´: 60ç§’
```

#### 2.0.2 é€šç”¨å“åº”æ ¼å¼

**æˆåŠŸå“åº”** (HTTP 200):
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}
```

**é”™è¯¯å“åº”** (HTTP 4xx/5xx):
```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯",
  "code": "ERROR_CODE",
  "details": { ... }
}
```

#### 2.0.3 é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | HTTPçŠ¶æ€ | è¯´æ˜ |
|-------|---------|------|
| `INVALID_CREDENTIALS` | 401 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| `TOKEN_EXPIRED` | 401 | Tokenå·²è¿‡æœŸ |
| `TOKEN_INVALID` | 401 | Tokenæ— æ•ˆ |
| `MISSING_PARAMETER` | 400 | ç¼ºå°‘å¿…éœ€å‚æ•° |
| `INVALID_FILE_FORMAT` | 400 | æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ |
| `FILE_TOO_LARGE` | 400 | æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ |
| `RECOGNITION_FAILED` | 500 | è¯†åˆ«æœåŠ¡å¤±è´¥ |
| `DATABASE_ERROR` | 500 | æ•°æ®åº“é”™è¯¯ |
| `LLM_SERVICE_ERROR` | 500 | LLMæœåŠ¡é”™è¯¯ |

---

### 2.1 ç”¨æˆ·è®¤è¯æ¥å£

#### 2.1.1 ç”¨æˆ·ç™»å½•

**æ¥å£åç§°**: ç”¨æˆ·ç™»å½•
**è¯·æ±‚æ–¹å¼**: POST
**è¯·æ±‚è·¯å¾„**: `/api/auth/login`
**æ˜¯å¦éœ€è¦è®¤è¯**: å¦

**è¯·æ±‚å‚æ•°** (Body - JSON):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|-----|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å | "admin" |
| password | string | æ˜¯ | å¯†ç ï¼ˆæ˜æ–‡ï¼‰ | "password123" |
| remember | boolean | å¦ | æ˜¯å¦è®°ä½ç™»å½•ï¼ˆå½±å“Tokenæœ‰æ•ˆæœŸï¼‰ | true |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "username": "admin",
  "password": "password123",
  "remember": true
}
```

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6Ilx1N2Y1Mlx1N2Y1Ylx1N2VkZlx1NzQwNlx1NTQ1OCIsImlhdCI6MTcwNTMwNTYwMCwiZXhwIjoxNzA1MzkyMDAwfQ.xxx",
  "user": {
    "id": 1,
    "username": "admin",
    "role": "ç³»ç»Ÿç®¡ç†å‘˜",
    "email": "admin@scnai.com",
    "realName": "ç®¡ç†å‘˜"
  }
}
```

**å“åº”æ•°æ®** (å¤±è´¥):
```json
{
  "success": false,
  "error": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "code": "INVALID_CREDENTIALS"
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®å
- **æ•°æ®å¤„ç†**:
  1. æ¥æ”¶Tokenåå­˜å‚¨åˆ°`localStorage.token`
  2. ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åˆ°`localStorage.user`
  3. è®¾ç½®Axiosé»˜è®¤è¯·æ±‚å¤´ï¼š`axios.defaults.headers.common['Authorization'] = 'Bearer ' + token`
  4. å¦‚æœremember=trueï¼Œå­˜å‚¨usernameåˆ°`localStorage.rememberedUsername`ç”¨äºä¸‹æ¬¡è‡ªåŠ¨å¡«å……
- **LoadingçŠ¶æ€**: æ˜¾ç¤º"ç™»å½•ä¸­..."ï¼Œç¦ç”¨è¡¨å•
- **é”™è¯¯å¤„ç†**:
  - 400: æ˜¾ç¤º"è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç "
  - 401: æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
  - 500: æ˜¾ç¤º"æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"
- **æˆåŠŸåæ“ä½œ**: è·³è½¬åˆ°`/dashboard`æˆ–ç”¨æˆ·è®¿é—®å‰çš„ç›®æ ‡é¡µé¢

**åç«¯å®ç°è¦ç‚¹**:
- å¯†ç éªŒè¯ä½¿ç”¨bcryptæ¯”å¯¹
- Tokenæœ‰æ•ˆæœŸï¼šremember=trueæ—¶7å¤©ï¼Œå¦åˆ™1å¤©
- Token payloadåŒ…å«ï¼šuser_id, username, role, iat, exp
- æ›´æ–°usersè¡¨çš„last_login_timeå’Œlast_login_ip
- å¢åŠ login_countè®¡æ•°
- è®°å½•åˆ°activity_logsè¡¨

---

#### 2.1.2 ç”¨æˆ·ç™»å‡º

**æ¥å£åç§°**: ç”¨æˆ·ç™»å‡º
**è¯·æ±‚æ–¹å¼**: POST
**è¯·æ±‚è·¯å¾„**: `/api/auth/logout`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»"é€€å‡ºç™»å½•"
- **æ•°æ®å¤„ç†**:
  1. è°ƒç”¨æ¥å£åï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰æ¸…é™¤`localStorage.token`å’Œ`localStorage.user`
  2. æ¸…é™¤Axiosé»˜è®¤è¯·æ±‚å¤´
  3. é‡å®šå‘åˆ°`/login`æˆ–é¦–é¡µ`/`
- **LoadingçŠ¶æ€**: æ˜¾ç¤º"é€€å‡ºä¸­..."
- **é”™è¯¯å¤„ç†**: å³ä½¿æ¥å£å¤±è´¥ä¹Ÿæ‰§è¡Œæœ¬åœ°æ¸…ç†

**åç«¯å®ç°è¦ç‚¹**:
- å¯é€‰ï¼šå°†TokenåŠ å…¥Redisé»‘åå•ï¼ˆè¿‡æœŸæ—¶é—´è®¾ä¸ºTokenå‰©ä½™æœ‰æ•ˆæœŸï¼‰
- è®°å½•ç™»å‡ºæ—¥å¿—åˆ°activity_logs

---

#### 2.1.3 éªŒè¯Token

**æ¥å£åç§°**: éªŒè¯Tokenæœ‰æ•ˆæ€§
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/auth/verify`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°**: æ— ï¼ˆTokenåœ¨Headerä¸­ï¼‰

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "user": {
    "id": 1,
    "username": "admin",
    "role": "ç³»ç»Ÿç®¡ç†å‘˜"
  }
}
```

**å“åº”æ•°æ®** (å¤±è´¥ - HTTP 401):
```json
{
  "success": false,
  "error": "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "code": "TOKEN_INVALID"
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**:
  1. åº”ç”¨å¯åŠ¨æ—¶ï¼ˆmain.jsä¸­ï¼‰
  2. è·¯ç”±å®ˆå«æ£€æŸ¥æ—¶ï¼ˆå¯é€‰ï¼Œå‡å°‘è¯·æ±‚å¯ç›´æ¥éªŒè¯æœ¬åœ°Tokenï¼‰
- **æ•°æ®å¤„ç†**: å¦‚æœè¿”å›401ï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
- **é”™è¯¯å¤„ç†**: Tokenè¿‡æœŸæ—¶æ˜¾ç¤º"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"

**åç«¯å®ç°è¦ç‚¹**:
- è§£æJWT Token
- æ£€æŸ¥Tokenæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼ˆå¦‚æœæœ‰é»‘åå•æœºåˆ¶ï¼‰
- è¿”å›ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

---

### 2.2 ä»ªè¡¨æ¿æ¥å£

#### 2.2.1 è·å–ç»Ÿè®¡æ•°æ®

**æ¥å£åç§°**: è·å–ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ï¼ˆæ— äººæœºçŠ¶æ€ + å¤©æ°”ä¿¡æ¯ï¼‰
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/dashboard/stats`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": {
    "drone": {
      "droneId": "UAV-001",
      "droneName": "å·¡æ£€ä¸€å·",
      "status": "æ­£å¸¸",
      "battery": 85,
      "range": 15000,
      "endurance": 45,
      "lastFlight": "2024-01-15 14:30:00"
    },
    "weather": {
      "temp": 24.0,
      "desc": "æ™´æœ—",
      "humidity": 65,
      "windSpeed": 3.5,
      "pressure": 1013,
      "feelsLike": 23.5,
      "uvIndex": 5,
      "forecast": [
        {"day": "ä»Šå¤©", "temp": 24, "desc": "æ™´", "icon": "â˜€ï¸"},
        {"day": "æ˜å¤©", "temp": 26, "desc": "å¤šäº‘", "icon": "â›…"},
        {"day": "åå¤©", "temp": 23, "desc": "å°é›¨", "icon": "ğŸŒ§ï¸"},
        {"day": "å‘¨å››", "temp": 22, "desc": "é˜´", "icon": "â˜ï¸"},
        {"day": "å‘¨äº”", "temp": 25, "desc": "æ™´", "icon": "â˜€ï¸"},
        {"day": "å‘¨å…­", "temp": 27, "desc": "æ™´", "icon": "â˜€ï¸"},
        {"day": "å‘¨æ—¥", "temp": 26, "desc": "å¤šäº‘", "icon": "â›…"}
      ]
    }
  }
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: è¿›å…¥`/dashboard`é¡µé¢æ—¶è°ƒç”¨
- **æ•°æ®å¤„ç†**:
  1. æ— äººæœºçŠ¶æ€å¡ç‰‡å±•ç¤ºï¼šçŠ¶æ€ï¼ˆé¢œè‰²æ ‡è¯†ï¼‰ã€ç”µé‡ï¼ˆè¿›åº¦æ¡ï¼‰ã€èˆªç¨‹ã€ç»­èˆª
  2. å¤©æ°”ä¿¡æ¯å¡ç‰‡ï¼šæ¸©åº¦ï¼ˆå¤§å·æ˜¾ç¤ºï¼‰ã€æè¿°ã€æ¹¿åº¦ã€é£é€Ÿã€æ°”å‹
  3. 7å¤©é¢„æŠ¥ï¼šæ¨ªå‘æ»šåŠ¨å±•ç¤º
- **LoadingçŠ¶æ€**: æ˜¾ç¤ºéª¨æ¶å±
- **é”™è¯¯å¤„ç†**: æ˜¾ç¤º"æ•°æ®åŠ è½½å¤±è´¥"ï¼Œæä¾›é‡è¯•æŒ‰é’®

**åç«¯å®ç°è¦ç‚¹**:
- æŸ¥è¯¢drone_statusè¡¨è·å–æœ€æ–°æ— äººæœºçŠ¶æ€ï¼ˆå¯è¿”å›ä¸»è¦æ— äººæœºæˆ–æ‰€æœ‰æ— äººæœºï¼‰
- å¤©æ°”æ•°æ®æ¥æºï¼š
  - ä¼˜å…ˆä»weather_dataè¡¨æŸ¥è¯¢æœ€è¿‘15åˆ†é’Ÿçš„è®°å½•
  - å¦‚æœæ²¡æœ‰æˆ–å·²è¿‡æœŸï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹å¤©æ°”APIï¼ˆå¦‚OpenWeatherMapï¼‰å¹¶ä¿å­˜
- 7å¤©é¢„æŠ¥å¯æå‰ç¼“å­˜ï¼Œæ¯6å°æ—¶æ›´æ–°ä¸€æ¬¡

---

#### 2.2.2 è·å–æœ€è¿‘æ´»åŠ¨

**æ¥å£åç§°**: è·å–ç”¨æˆ·æœ€è¿‘æ´»åŠ¨è®°å½•
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/dashboard/activities`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°** (Query):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|-------|------|-----|------|-------|
| limit | int | å¦ | è¿”å›è®°å½•æ•°é‡ | 10 |

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": [
    {
      "id": 156,
      "type": "è¯†åˆ«",
      "action": "åœ¨ä¸œåŒºè¯†åˆ«å‡ºç™½ç²‰ç—…",
      "time": "2024-01-15 14:30:25"
    },
    {
      "id": 155,
      "type": "æ“ä½œ",
      "action": "å¯¼å‡ºäº†å¯è§†åŒ–æ•°æ®æŠ¥å‘Š",
      "time": "2024-01-15 14:25:10"
    },
    {
      "id": 154,
      "type": "æŸ¥çœ‹",
      "action": "æŸ¥çœ‹äº†ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®",
      "time": "2024-01-15 14:20:05"
    }
  ]
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: è¿›å…¥`/dashboard`é¡µé¢æ—¶è°ƒç”¨
- **æ•°æ®å¤„ç†**:
  1. ä»¥åˆ—è¡¨å½¢å¼å±•ç¤ºï¼Œæ¯æ¡è®°å½•åŒ…å«ï¼šç±»å‹ï¼ˆå›¾æ ‡ï¼‰ã€åŠ¨ä½œã€æ—¶é—´
  2. ç±»å‹ä¸åŒç”¨ä¸åŒé¢œè‰²å›¾æ ‡ï¼šè¯†åˆ«ï¼ˆè“è‰²ï¼‰ã€æ“ä½œï¼ˆç»¿è‰²ï¼‰ã€æŸ¥çœ‹ï¼ˆç°è‰²ï¼‰
  3. æ—¶é—´æ ¼å¼åŒ–ï¼šä»Šå¤©æ˜¾ç¤º"HH:mm"ï¼Œæ˜¨å¤©æ˜¾ç¤º"æ˜¨å¤© HH:mm"ï¼Œæ›´æ—©æ˜¾ç¤º"MM-DD HH:mm"
- **LoadingçŠ¶æ€**: æ˜¾ç¤ºéª¨æ¶å±
- **é”™è¯¯å¤„ç†**: é™é»˜å¤±è´¥æˆ–æ˜¾ç¤º"æš‚æ— æ´»åŠ¨è®°å½•"

**åç«¯å®ç°è¦ç‚¹**:
- æŸ¥è¯¢activity_logsè¡¨
- ç­›é€‰æ¡ä»¶ï¼šuser_id = å½“å‰ç”¨æˆ·ID
- æ’åºï¼šcreated_at DESC
- é™åˆ¶ï¼šLIMIT {limit}

---

#### 2.2.3 è·å–ç—…è™«å®³è®°å½•

**æ¥å£åç§°**: è·å–ç—…è™«å®³è¯†åˆ«è®°å½•åˆ—è¡¨
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/dashboard/records`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°** (Query):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|-------|------|-----|------|-------|
| page | int | å¦ | é¡µç ï¼ˆä»1å¼€å§‹ï¼‰ | 1 |
| pageSize | int | å¦ | æ¯é¡µæ•°é‡ | 10 |
| area | string | å¦ | ç­›é€‰åŒºåŸŸ | - |
| status | string | å¦ | ç­›é€‰çŠ¶æ€ | - |

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": {
    "total": 156,
    "page": 1,
    "pageSize": 10,
    "totalPages": 16,
    "records": [
      {
        "id": 123,
        "date": "2024-01-15",
        "time": "14:30:25",
        "area": "ä¸œåŒº",
        "diseaseType": "ç™½ç²‰ç—…",
        "count": 23,
        "severity": "ä¸­åº¦",
        "status": "å¤„ç†ä¸­",
        "confidence": 0.9342
      },
      {
        "id": 122,
        "date": "2024-01-15",
        "time": "13:45:12",
        "area": "è¥¿åŒº",
        "diseaseType": "éœœéœ‰ç—…",
        "count": 15,
        "severity": "é‡åº¦",
        "status": "æœªå¤„ç†",
        "confidence": 0.8756
      }
    ]
  }
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: è¿›å…¥`/dashboard`é¡µé¢æ—¶è°ƒç”¨
- **æ•°æ®å¤„ç†**:
  1. è¡¨æ ¼å±•ç¤ºï¼šæ—¥æœŸã€åŒºåŸŸã€ç—…è™«å®³ã€æ•°é‡ã€ä¸¥é‡ç¨‹åº¦ã€å¤„ç†çŠ¶æ€
  2. ä¸¥é‡ç¨‹åº¦ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡ç­¾ï¼šè½»åº¦ï¼ˆç»¿è‰²ï¼‰ã€ä¸­åº¦ï¼ˆé»„è‰²ï¼‰ã€é‡åº¦ï¼ˆçº¢è‰²ï¼‰
  3. å¤„ç†çŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡ç­¾ï¼šå·²å¤„ç†ï¼ˆç°è‰²ï¼‰ã€å¤„ç†ä¸­ï¼ˆè“è‰²ï¼‰ã€æœªå¤„ç†ï¼ˆçº¢è‰²ï¼‰
  4. ç‚¹å‡»è¡Œå¯æŸ¥çœ‹è¯¦æƒ…ï¼ˆè·³è½¬æˆ–å¼¹çª—ï¼‰
- **åˆ†é¡µå¤„ç†**: ä½¿ç”¨Element Plusçš„Paginationç»„ä»¶
- **LoadingçŠ¶æ€**: è¡¨æ ¼æ˜¾ç¤ºloadingæ•ˆæœ
- **é”™è¯¯å¤„ç†**: æ˜¾ç¤º"æ•°æ®åŠ è½½å¤±è´¥"

**åç«¯å®ç°è¦ç‚¹**:
- æŸ¥è¯¢recognition_recordsè¡¨
- å¯é€‰ç­›é€‰æ¡ä»¶ï¼šarea, status
- æŒ‰identify_time DESCæ’åº
- åˆ†é¡µï¼šLIMIT {pageSize} OFFSET {(page-1)*pageSize}
- è¿”å›æ€»è®°å½•æ•°ç”¨äºè®¡ç®—æ€»é¡µæ•°

---

### 2.3 å›¾åƒè¯†åˆ«æ¥å£

#### 2.3.1 è¯†åˆ«å›¾åƒ

**æ¥å£åç§°**: ä¸Šä¼ å›¾åƒå¹¶è¯†åˆ«ç—…è™«å®³
**è¯·æ±‚æ–¹å¼**: POST
**è¯·æ±‚è·¯å¾„**: `/api/recognition`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯
**Content-Type**: `multipart/form-data`

**è¯·æ±‚å‚æ•°** (FormData):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|-----|------|------|
| image | File | æ˜¯ | å›¾åƒæ–‡ä»¶ï¼ˆJPG/PNGï¼Œæœ€å¤§3MBï¼‰ | - |
| area | string | å¦ | æ‰€å±åŒºåŸŸ | "ä¸œåŒº" |
| droneId | string | å¦ | æ— äººæœºç¼–å· | "UAV-001" |
| locationLat | float | å¦ | çº¬åº¦ | 30.12345 |
| locationLng | float | å¦ | ç»åº¦ | 120.67890 |

**è¯·æ±‚ç¤ºä¾‹** (JavaScript):
```javascript
const formData = new FormData();
formData.append('image', file); // fileæ˜¯Fileå¯¹è±¡
formData.append('area', 'ä¸œåŒº');
formData.append('droneId', 'UAV-001');

const response = await recognitionService.recognize(formData);
```

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": {
    "id": 123,
    "diseaseType": "powdery",
    "diseaseTypeName": "ç™½ç²‰ç—…",
    "confidence": 0.9342,
    "severity": "ä¸­åº¦",
    "identifyTime": "2024-01-15 15:30:45",
    "imageUrl": "/uploads/recognition/2024/01/15/image_abc123.jpg",
    "thumbnailUrl": "/uploads/recognition/2024/01/15/thumb_image_abc123.jpg",
    "symptoms": "å¶ç‰‡è¡¨é¢å‡ºç°ç™½è‰²ç²‰çŠ¶ç‰©ï¼Œéƒ¨åˆ†å¶ç‰‡å¼€å§‹é»„åŒ–",
    "treatmentPlan": "å»ºè®®ä½¿ç”¨ç¡«ç£ºç²‰æˆ–ä¸‰å”‘é…®ç±»æ€èŒå‰‚è¿›è¡Œé˜²æ²»",
    "rawPredictions": {
      "powdery": 0.9342,
      "downy": 0.0234,
      "anthracnose": 0.0156,
      "virus": 0.0098,
      "aphid": 0.0120,
      "healthy": 0.0050
    }
  }
}
```

**å“åº”æ•°æ®** (å¤±è´¥):
```json
{
  "success": false,
  "error": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œä»…æ”¯æŒJPGå’ŒPNGæ ¼å¼",
  "code": "INVALID_FILE_FORMAT"
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: ç”¨æˆ·é€‰æ‹©å›¾åƒåç‚¹å‡»"å¼€å§‹è¯†åˆ«"
- **æ•°æ®å¤„ç†**:
  1. æ˜¾ç¤ºè¯†åˆ«ä¸­åŠ¨ç”»ï¼ˆæ—‹è½¬å›¾æ ‡ + "AIæ­£åœ¨åˆ†æå›¾åƒ..."ï¼‰
  2. æ¥æ”¶ç»“æœåå±•ç¤ºï¼š
     - ç—…å®³ç±»å‹ï¼ˆå¤§å·æ˜¾ç¤ºä¸­æ–‡åç§°ï¼‰
     - ç½®ä¿¡åº¦ï¼ˆè¿›åº¦æ¡ï¼Œé¢œè‰²æ ¹æ®ç½®ä¿¡åº¦ï¼š>0.8ç»¿è‰²ï¼Œ0.5-0.8é»„è‰²ï¼Œ<0.5çº¢è‰²ï¼‰
     - ä¸¥é‡ç¨‹åº¦ï¼ˆæ ‡ç­¾ï¼Œè½»åº¦/ä¸­åº¦/é‡åº¦ï¼‰
     - è¯†åˆ«æ—¶é—´
     - ç—‡çŠ¶æè¿°
     - å¤„ç†å»ºè®®
  3. ä¿ç•™åŸå§‹å›¾åƒé¢„è§ˆ
- **LoadingçŠ¶æ€**: ç¦ç”¨è¡¨å•ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆå¯æ¨¡æ‹Ÿè¿›åº¦0% -> 95% -> å®Œæˆæ—¶100%ï¼‰
- **é”™è¯¯å¤„ç†**:
  - `INVALID_FILE_FORMAT`: æç¤º"ä»…æ”¯æŒJPGå’ŒPNGæ ¼å¼"
  - `FILE_TOO_LARGE`: æç¤º"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡3MB"
  - `RECOGNITION_FAILED`: æç¤º"è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–æ›´æ¢å›¾åƒ"
- **è¶…æ—¶å¤„ç†**: 60ç§’è¶…æ—¶åæç¤º"è¯†åˆ«è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"

**åç«¯å®ç°è¦ç‚¹**:
1. **æ–‡ä»¶éªŒè¯**:
   - æ£€æŸ¥æ–‡ä»¶MIMEç±»å‹ï¼šimage/jpeg, image/png
   - æ£€æŸ¥æ–‡ä»¶å¤§å° <= 3MB
2. **æ–‡ä»¶å­˜å‚¨**:
   - ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼š`{timestamp}_{uuid}.{ext}`
   - ä¿å­˜åˆ°ï¼š`/uploads/recognition/{year}/{month}/{day}/`
   - ç”Ÿæˆç¼©ç•¥å›¾ï¼ˆå¯é€‰ï¼Œç”¨äºåˆ—è¡¨å±•ç¤ºï¼‰
3. **AIè¯†åˆ«**:
   - åŠ è½½å›¾åƒå¹¶é¢„å¤„ç†ï¼ˆè°ƒæ•´å¤§å°ã€å½’ä¸€åŒ–ï¼‰
   - è°ƒç”¨æ¨¡å‹æ¨ç†
   - è·å–æ‰€æœ‰ç±»åˆ«çš„ç½®ä¿¡åº¦
4. **åˆ¤æ–­ä¸¥é‡ç¨‹åº¦**:
   - confidence > 0.8 ä¸”éhealthy â†’ "é‡åº¦"
   - 0.5 < confidence <= 0.8 â†’ "ä¸­åº¦"
   - confidence <= 0.5 â†’ "è½»åº¦"
5. **ä¿å­˜è®°å½•**:
   - æ’å…¥recognition_recordsè¡¨
   - æ’å…¥activity_logsè¡¨ï¼ˆtype='è¯†åˆ«', action='åœ¨{area}è¯†åˆ«å‡º{disease}'ï¼‰
6. **è¿”å›ç»“æœ**:
   - åŒ…å«å®Œæ•´è¯†åˆ«ä¿¡æ¯
   - imageUrlä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–å®Œæ•´URL
7. **é”™è¯¯å¤„ç†**:
   - æ•è·æ¨¡å‹æ¨ç†å¼‚å¸¸
   - æ–‡ä»¶ä¿å­˜å¤±è´¥æ—¶æ¸…ç†å·²ä¸Šä¼ æ–‡ä»¶

---

### 2.4 æ•°æ®å¯è§†åŒ–æ¥å£

#### 2.4.1 è·å–å¯è§†åŒ–æ•°æ®

**æ¥å£åç§°**: è·å–æ•°æ®å¯è§†åŒ–çš„å›¾è¡¨æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/visualization/data`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°** (Query):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ | é»˜è®¤å€¼ |
|-------|------|-----|------|------|-------|
| timeRange | int | æ˜¯ | æ—¶é—´èŒƒå›´ï¼ˆå¤©æ•°ï¼‰ | 7/30/90/180/365 | 7 |
| area | string | å¦ | ç­›é€‰åŒºåŸŸ | "ä¸œåŒº"/"å…¨éƒ¨" | "å…¨éƒ¨" |
| diseaseType | string | å¦ | ç—…è™«å®³ç±»å‹ | "powdery" | - |
| droneId | string | å¦ | æ— äººæœºç¼–å· | "UAV-001" | - |
| page | int | å¦ | è¯¦ç»†è®°å½•é¡µç  | 1 | 1 |
| pageSize | int | å¦ | è¯¦ç»†è®°å½•æ¯é¡µæ•°é‡ | 10 | 10 |

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": {
    "summary": {
      "totalArea": 1250,
      "healthRate": 87.5,
      "warningCount": 12,
      "totalRecognitions": 456
    },
    "diseaseDistribution": {
      "labels": ["ç™½ç²‰ç—…", "éœœéœ‰ç—…", "ç‚­ç–½ç—…", "ç—…æ¯’ç—…", "èšœè™«"],
      "data": [45, 23, 12, 8, 12],
      "colors": ["#4ade80", "#fbbf24", "#f87171", "#a78bfa", "#60a5fa"]
    },
    "healthTrend": {
      "labels": ["01-09", "01-10", "01-11", "01-12", "01-13", "01-14", "01-15"],
      "data": [85.2, 87.1, 84.5, 86.3, 89.0, 88.2, 87.5]
    },
    "areaDistribution": {
      "labels": ["01-09", "01-10", "01-11", "01-12", "01-13", "01-14", "01-15"],
      "datasets": [
        {
          "label": "ä¸œåŒº",
          "data": [12, 15, 18, 14, 16, 13, 15],
          "backgroundColor": "#4ade80"
        },
        {
          "label": "è¥¿åŒº",
          "data": [8, 10, 12, 9, 11, 10, 9],
          "backgroundColor": "#fbbf24"
        },
        {
          "label": "å—åŒº",
          "data": [6, 8, 7, 9, 8, 7, 8],
          "backgroundColor": "#f87171"
        },
        {
          "label": "åŒ—åŒº",
          "data": [5, 7, 6, 8, 7, 6, 7],
          "backgroundColor": "#a78bfa"
        },
        {
          "label": "ä¸­å¿ƒåŒº",
          "data": [10, 12, 14, 11, 13, 12, 11],
          "backgroundColor": "#60a5fa"
        }
      ]
    },
    "efficiencyStats": {
      "labels": ["01-09", "01-10", "01-11", "01-12", "01-13", "01-14", "01-15"],
      "recognitionCount": [45, 52, 48, 55, 50, 48, 50],
      "avgConfidence": [0.85, 0.87, 0.86, 0.88, 0.87, 0.86, 0.87]
    },
    "detailRecords": {
      "total": 156,
      "page": 1,
      "pageSize": 10,
      "records": [
        {
          "id": 123,
          "date": "2024-01-15",
          "time": "14:30:25",
          "area": "ä¸œåŒº",
          "diseaseType": "ç™½ç²‰ç—…",
          "severity": "ä¸­åº¦",
          "confidence": 0.9342,
          "droneId": "UAV-001",
          "status": "å¤„ç†ä¸­"
        }
      ]
    }
  }
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**:
  1. è¿›å…¥`/visualization`é¡µé¢æ—¶è°ƒç”¨ï¼ˆé»˜è®¤å‚æ•°ï¼‰
  2. ç‚¹å‡»"åº”ç”¨ç­›é€‰"æŒ‰é’®åè°ƒç”¨
- **æ•°æ®å¤„ç†**:
  1. **æ±‡æ€»ç»Ÿè®¡å¡ç‰‡**:
     - ç›‘æµ‹æ€»é¢ç§¯ï¼š`{totalArea} äº©`
     - å¥åº·ç‡ï¼š`{healthRate}%`ï¼ˆç»¿è‰²ï¼‰
     - è­¦å‘Šæ•°é‡ï¼š`{warningCount}`ï¼ˆçº¢è‰²ï¼‰
     - æ€»è¯†åˆ«æ¬¡æ•°ï¼š`{totalRecognitions}`
  2. **ç—…è™«å®³åˆ†å¸ƒï¼ˆç”œç”œåœˆå›¾ï¼‰**:
     ```javascript
     new Chart(ctx, {
       type: 'doughnut',
       data: {
         labels: data.diseaseDistribution.labels,
         datasets: [{
           data: data.diseaseDistribution.data,
           backgroundColor: data.diseaseDistribution.colors
         }]
       }
     });
     ```
  3. **å¥åº·åº¦è¶‹åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰**:
     ```javascript
     new Chart(ctx, {
       type: 'line',
       data: {
         labels: data.healthTrend.labels,
         datasets: [{
           label: 'å¥åº·ç‡',
           data: data.healthTrend.data,
           borderColor: '#4ade80',
           tension: 0.4
         }]
       }
     });
     ```
  4. **å„åŒºåŸŸç—…è™«å®³åˆ†å¸ƒï¼ˆå †ç§¯æŸ±çŠ¶å›¾ï¼‰**:
     ```javascript
     new Chart(ctx, {
       type: 'bar',
       data: {
         labels: data.areaDistribution.labels,
         datasets: data.areaDistribution.datasets
       },
       options: {
         scales: {
           x: { stacked: true },
           y: { stacked: true }
         }
       }
     });
     ```
  5. **è¯†åˆ«æ•ˆç‡ç»Ÿè®¡ï¼ˆåŒYè½´æŠ˜çº¿å›¾ï¼‰**:
     ```javascript
     new Chart(ctx, {
       type: 'line',
       data: {
         labels: data.efficiencyStats.labels,
         datasets: [
           {
             label: 'è¯†åˆ«æ¬¡æ•°',
             data: data.efficiencyStats.recognitionCount,
             yAxisID: 'y',
             borderColor: '#60a5fa'
           },
           {
             label: 'å¹³å‡ç½®ä¿¡åº¦',
             data: data.efficiencyStats.avgConfidence,
             yAxisID: 'y1',
             borderColor: '#4ade80'
           }
         ]
       },
       options: {
         scales: {
           y: { position: 'left' },
           y1: { position: 'right', max: 1 }
         }
       }
     });
     ```
  6. **è¯¦ç»†è®°å½•è¡¨æ ¼**: ä½¿ç”¨åˆ†é¡µç»„ä»¶å±•ç¤º
- **LoadingçŠ¶æ€**: æ˜¾ç¤ºå…¨å±€loadingæˆ–éª¨æ¶å±
- **é”™è¯¯å¤„ç†**: æ˜¾ç¤º"æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"

**åç«¯å®ç°è¦ç‚¹**:
1. **æ„å»ºæŸ¥è¯¢æ¡ä»¶**:
   ```sql
   WHERE identify_time >= DATE_SUB(NOW(), INTERVAL {timeRange} DAY)
     AND (area = {area} OR {area} = 'å…¨éƒ¨')
     AND (disease_type = {diseaseType} OR {diseaseType} IS NULL)
     AND (drone_id = {droneId} OR {droneId} IS NULL)
   ```
2. **è®¡ç®—æ±‡æ€»ç»Ÿè®¡**:
   - totalArea: é…ç½®å€¼æˆ–ä»é…ç½®è¡¨è¯»å–
   - healthRate: `(æ€»è¯†åˆ«æ•° - ç—…å®³æ•°) / æ€»è¯†åˆ«æ•° * 100`
   - warningCount: `COUNT(*) WHERE severity = 'é‡åº¦'`
   - totalRecognitions: `COUNT(*)`
3. **èšåˆç—…è™«å®³åˆ†å¸ƒ**:
   ```sql
   SELECT disease_type_name, COUNT(*) as count
   FROM recognition_records
   WHERE ...
   GROUP BY disease_type_name
   ```
4. **èšåˆå¥åº·åº¦è¶‹åŠ¿**:
   ```sql
   SELECT DATE(identify_time) as date,
          (COUNT(*) - SUM(CASE WHEN disease_type != 'healthy' THEN 1 ELSE 0 END)) / COUNT(*) * 100 as health_rate
   FROM recognition_records
   WHERE ...
   GROUP BY DATE(identify_time)
   ORDER BY date
   ```
5. **èšåˆå„åŒºåŸŸåˆ†å¸ƒ**:
   ```sql
   SELECT DATE(identify_time) as date, area, COUNT(*) as count
   FROM recognition_records
   WHERE ...
   GROUP BY DATE(identify_time), area
   ORDER BY date, area
   ```
   åç«¯éœ€è¦è½¬æ¢ä¸ºå‰ç«¯æ‰€éœ€çš„datasetsæ ¼å¼
6. **ç»Ÿè®¡è¯†åˆ«æ•ˆç‡**:
   ```sql
   SELECT DATE(identify_time) as date,
          COUNT(*) as recognition_count,
          AVG(confidence) as avg_confidence
   FROM recognition_records
   WHERE ...
   GROUP BY DATE(identify_time)
   ORDER BY date
   ```
7. **æŸ¥è¯¢è¯¦ç»†è®°å½•**: åŒ`/api/dashboard/records`æ¥å£
8. **æ€§èƒ½ä¼˜åŒ–**:
   - æ·»åŠ ç´¢å¼•ï¼šidentify_time, area, disease_type, drone_id
   - å¯¹äºå¤§æ•°æ®é‡ï¼Œè€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼ˆRedisï¼‰
   - ä½¿ç”¨prepared statementé˜²æ­¢SQLæ³¨å…¥

---

### 2.5 æ™ºèƒ½é—®ç­”æ¥å£

#### 2.5.1 æµå¼é—®ç­”

**æ¥å£åç§°**: æ™ºèƒ½é—®ç­”ï¼ˆæµå¼SSEå“åº”ï¼‰
**è¯·æ±‚æ–¹å¼**: POST
**è¯·æ±‚è·¯å¾„**: `/api/chat/stream`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯
**Content-Type**: `application/json`
**å“åº”ç±»å‹**: `text/event-stream`

**è¯·æ±‚å‚æ•°** (Body - JSON):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|-----|------|------|
| message | string | æ˜¯ | ç”¨æˆ·æ¶ˆæ¯å†…å®¹ | "ä¸ç“œç™½ç²‰ç—…çš„ä¸»è¦ç—‡çŠ¶æ˜¯ä»€ä¹ˆï¼Ÿ" |
| history | array | å¦ | å¯¹è¯å†å²ï¼ˆå¯é€‰ï¼Œç”¨äºä¸Šä¸‹æ–‡ç†è§£ï¼‰ | è§ä¸‹æ–¹ç¤ºä¾‹ |
| sessionId | string | å¦ | ä¼šè¯IDï¼ˆç”¨äºå…³è”å¤šè½®å¯¹è¯ï¼‰ | "session_abc123" |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "message": "ä¸ç“œç™½ç²‰ç—…çš„ä¸»è¦ç—‡çŠ¶æ˜¯ä»€ä¹ˆï¼Ÿ",
  "history": [
    {
      "role": "user",
      "content": "ä½ å¥½"
    },
    {
      "role": "assistant",
      "content": "ä½ å¥½ï¼æˆ‘æ˜¯SCNAIæ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“æ³¨äºæ¤ç‰©ç—…è™«å®³è¯†åˆ«å’Œé˜²æ²»å»ºè®®ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ"
    }
  ],
  "sessionId": "session_20240115_143025"
}
```

**å“åº”æ•°æ®** (SSEæµå¼):

**äº‹ä»¶ç±»å‹1 - æ–‡æœ¬å—** (é€æ­¥å‘é€):
```
data: {"type":"chunk","content":"ä¸ç“œ"}

data: {"type":"chunk","content":"ç™½ç²‰ç—…"}

data: {"type":"chunk","content":"çš„ä¸»è¦"}

data: {"type":"chunk","content":"ç—‡çŠ¶åŒ…æ‹¬ï¼š"}
```

**äº‹ä»¶ç±»å‹2 - å®Œæˆ**:
```
data: {"type":"complete","fullContent":"ä¸ç“œç™½ç²‰ç—…çš„ä¸»è¦ç—‡çŠ¶åŒ…æ‹¬ï¼š\n\n1. å¶ç‰‡ç—‡çŠ¶\n- åˆæœŸå¶ç‰‡æ­£é¢å‡ºç°ç™½è‰²ç²‰çŠ¶æ–‘ç‚¹\n- é€æ¸æ‰©å¤§å½¢æˆä¸è§„åˆ™çš„ç™½è‰²ç²‰çŠ¶ç‰©\n- ä¸¥é‡æ—¶æ•´ä¸ªå¶ç‰‡å¸ƒæ»¡ç™½ç²‰ï¼Œå¶ç‰‡é»„åŒ–æ¯è\n\n2. èŒç§†ç—‡çŠ¶\n- å«©èŒä¸Šä¹Ÿä¼šå‡ºç°ç™½è‰²ç²‰çŠ¶éœ‰å±‚\n- å½±å“å…»åˆ†ä¼ è¾“\n\n3. æœå®ç—‡çŠ¶\n- æœå®è¡¨é¢å¯èƒ½å‡ºç°ç™½è‰²ç²‰çŠ¶ç‰©\n- å½±å“æœå®å“è´¨å’Œå•†å“ä»·å€¼\n\n**é˜²æ²»å»ºè®®ï¼š**\n- åŠ å¼ºé€šé£é€å…‰ï¼Œé™ä½æ¹¿åº¦\n- åŠæ—¶æ‘˜é™¤ç—…å¶\n- ä½¿ç”¨ç¡«ç£ºç²‰æˆ–ä¸‰å”‘é…®ç±»æ€èŒå‰‚é˜²æ²»"}
```

**äº‹ä»¶ç±»å‹3 - é”™è¯¯**:
```
data: {"type":"error","error":"LLMæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**:
  1. ç”¨æˆ·è¾“å…¥æ¶ˆæ¯åæŒ‰Enteræˆ–ç‚¹å‡»å‘é€æŒ‰é’®
  2. ç‚¹å‡»å¿«æ·å»ºè®®æŒ‰é’®
- **æ•°æ®å¤„ç†**:
  1. ä½¿ç”¨Fetch APIå¤„ç†SSE:
     ```javascript
     const response = await fetch('/api/chat/stream', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
         'Authorization': `Bearer ${token}`
       },
       body: JSON.stringify({ message, history })
     });

     const reader = response.body.getReader();
     const decoder = new TextDecoder();
     let buffer = '';

     while (true) {
       const { done, value } = await reader.read();
       if (done) break;

       buffer += decoder.decode(value, { stream: true });
       const lines = buffer.split('\n');
       buffer = lines.pop();

       for (const line of lines) {
         if (line.startsWith('data: ')) {
           const data = JSON.parse(line.slice(6));
           if (data.type === 'chunk') {
             // è¿½åŠ æ–‡æœ¬åˆ°å½“å‰æ¶ˆæ¯
             currentMessage.content += data.content;
           } else if (data.type === 'complete') {
             // å®Œæˆï¼Œä¿å­˜å®Œæ•´å†…å®¹
             currentMessage.content = data.fullContent;
             currentMessage.isComplete = true;
           } else if (data.type === 'error') {
             // æ˜¾ç¤ºé”™è¯¯
             showError(data.error);
           }
         }
       }
     }
     ```
  2. æ¶ˆæ¯æ ¼å¼åŒ–ï¼š
     - è¯†åˆ«å°æ ‡é¢˜ï¼ˆåŠ ç²—æ˜¾ç¤ºï¼‰
     - è¯†åˆ«åˆ†ç‚¹åˆ—è¡¨ï¼ˆæ·»åŠ åºå·æˆ–åœ†ç‚¹ï¼‰
     - è¯†åˆ«æ®µè½ï¼ˆæ·»åŠ é—´è·ï¼‰
  3. æ¶ˆæ¯åˆ—è¡¨è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  4. ä¿å­˜å¯¹è¯å†å²ï¼ˆç”¨äºä¸‹æ¬¡å‘é€æ—¶æºå¸¦ä¸Šä¸‹æ–‡ï¼‰
- **LoadingçŠ¶æ€**:
  - å‘é€æ—¶æ˜¾ç¤º"æ€è€ƒä¸­..."å ä½æ¶ˆæ¯
  - ç¦ç”¨è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®
  - æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªchunkåç§»é™¤å ä½æ¶ˆæ¯ï¼Œå¼€å§‹æ˜¾ç¤ºå®é™…å†…å®¹
- **é”™è¯¯å¤„ç†**:
  - è¿æ¥ä¸­æ–­ï¼šæ˜¾ç¤º"è¿æ¥å·²æ–­å¼€ï¼Œè¯·é‡è¯•"
  - LLMé”™è¯¯ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  - è¶…æ—¶ï¼š60ç§’æ— å“åº”æç¤ºè¶…æ—¶
- **ç‰¹æ®Šå¤„ç†**:
  - æ”¯æŒä¸­æ–­ï¼šæä¾›"åœæ­¢ç”Ÿæˆ"æŒ‰é’®ï¼ˆè°ƒç”¨reader.cancel()ï¼‰

**åç«¯å®ç°è¦ç‚¹**:
1. **SSEé…ç½®**:
   ```java
   response.setContentType("text/event-stream");
   response.setCharacterEncoding("UTF-8");
   response.setHeader("Cache-Control", "no-cache");
   response.setHeader("Connection", "keep-alive");
   response.setHeader("X-Accel-Buffering", "no");
   ```
2. **è°ƒç”¨LLM API**:
   - ä½¿ç”¨OpenAI APIæˆ–DeepSeek API
   - è®¾ç½®stream=trueå¼€å¯æµå¼å“åº”
   - æ„å»ºmessagesæ•°ç»„ï¼šç³»ç»Ÿæç¤º + å†å²å¯¹è¯ + ç”¨æˆ·æ¶ˆæ¯
   ```java
   List<Message> messages = new ArrayList<>();
   messages.add(new Message("system", "ä½ æ˜¯SCNAIæ¤ç‰©ç—…è™«å®³è¯†åˆ«ç³»ç»Ÿçš„æ™ºèƒ½åŠ©æ‰‹..."));
   for (HistoryItem item : history) {
       messages.add(new Message(item.getRole(), item.getContent()));
   }
   messages.add(new Message("user", message));
   ```
3. **æµå¼è¿”å›**:
   ```java
   try (BufferedWriter writer = response.getWriter()) {
       openAIService.streamChat(messages, chunk -> {
           String json = String.format("{\"type\":\"chunk\",\"content\":\"%s\"}",
               escapeJson(chunk));
           writer.write("data: " + json + "\n\n");
           writer.flush();
       });

       String completeJson = String.format("{\"type\":\"complete\",\"fullContent\":\"%s\"}",
           escapeJson(fullContent));
       writer.write("data: " + completeJson + "\n\n");
       writer.flush();
   } catch (Exception e) {
       String errorJson = String.format("{\"type\":\"error\",\"error\":\"%s\"}",
           e.getMessage());
       writer.write("data: " + errorJson + "\n\n");
       writer.flush();
   }
   ```
4. **ä¿å­˜å¯¹è¯å†å²**:
   - åœ¨completeäº‹ä»¶å‘é€åï¼Œä¿å­˜åˆ°chat_historyè¡¨
   - è®°å½•ï¼šuser_id, message, response, session_id, model_name
5. **é”™è¯¯å¤„ç†**:
   - æ•è·LLM APIå¼‚å¸¸
   - è¶…æ—¶å¤„ç†ï¼ˆè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚120ç§’ï¼‰
   - å‘é€erroräº‹ä»¶ç»™å‰ç«¯
6. **æ€§èƒ½ä¼˜åŒ–**:
   - ä½¿ç”¨è¿æ¥æ± ç®¡ç†HTTPè¿æ¥
   - é™åˆ¶æ¯ä¸ªç”¨æˆ·çš„å¹¶å‘è¯·æ±‚æ•°ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
   - å®ç°è¯·æ±‚é˜Ÿåˆ—ï¼ˆé«˜å¹¶å‘æ—¶æ’é˜Ÿå¤„ç†ï¼‰

---

### 2.6 ä¸ªäººä¿¡æ¯æ¥å£

#### 2.6.1 è·å–ç”¨æˆ·ä¿¡æ¯

**æ¥å£åç§°**: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
**è¯·æ±‚æ–¹å¼**: GET
**è¯·æ±‚è·¯å¾„**: `/api/user/profile`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°**: æ— ï¼ˆä»Tokenä¸­è·å–user_idï¼‰

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "admin",
    "email": "admin@scnai.com",
    "phone": "13812345678",
    "realName": "å¼ ä¸‰",
    "role": "ç³»ç»Ÿç®¡ç†å‘˜",
    "organization": "SCNAIç ”ç©¶ä¸­å¿ƒ",
    "avatarUrl": "/uploads/avatars/user_1.jpg",
    "loginCount": 156,
    "lastLoginTime": "2024-01-15 14:30:25",
    "createdAt": "2023-06-01 10:00:00"
  }
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: è¿›å…¥`/profile`é¡µé¢æ—¶è°ƒç”¨
- **æ•°æ®å¤„ç†**: å±•ç¤ºåœ¨ä¸ªäººä¿¡æ¯å¡ç‰‡ä¸­
- **LoadingçŠ¶æ€**: æ˜¾ç¤ºéª¨æ¶å±
- **é”™è¯¯å¤„ç†**: æ˜¾ç¤º"åŠ è½½å¤±è´¥"

---

#### 2.6.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£åç§°**: æ›´æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
**è¯·æ±‚æ–¹å¼**: PUT
**è¯·æ±‚è·¯å¾„**: `/api/user/profile`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°** (Body - JSON):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|-----|------|------|
| email | string | å¦ | é‚®ç®±åœ°å€ | "user@example.com" |
| phone | string | å¦ | æ‰‹æœºå·ç  | "13812345678" |
| realName | string | å¦ | çœŸå®å§“å | "å¼ ä¸‰" |
| organization | string | å¦ | æ‰€å±ç»„ç»‡ | "SCNAIç ”ç©¶ä¸­å¿ƒ" |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "email": "newemail@example.com",
  "phone": "13900001111",
  "realName": "å¼ ä¸‰"
}
```

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "message": "ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "admin",
    "email": "newemail@example.com",
    "phone": "13900001111",
    "realName": "å¼ ä¸‰"
  }
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"æŒ‰é’®
- **æ•°æ®å¤„ç†**:
  1. è¡¨å•éªŒè¯ï¼šé‚®ç®±æ ¼å¼ã€æ‰‹æœºå·æ ¼å¼
  2. æˆåŠŸåæ›´æ–°é¡µé¢æ˜¾ç¤º
  3. æ›´æ–°localStorageä¸­çš„ç”¨æˆ·ä¿¡æ¯
- **LoadingçŠ¶æ€**: æŒ‰é’®æ˜¾ç¤º"ä¿å­˜ä¸­..."ï¼Œç¦ç”¨è¡¨å•
- **é”™è¯¯å¤„ç†**: æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯

**åç«¯å®ç°è¦ç‚¹**:
- ä»Tokenè·å–user_id
- éªŒè¯é‚®ç®±æ ¼å¼ã€æ‰‹æœºå·æ ¼å¼
- æ£€æŸ¥é‚®ç®±/æ‰‹æœºå·æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨
- æ›´æ–°usersè¡¨
- è®°å½•activity_logs

---

#### 2.6.3 ä¿®æ”¹å¯†ç 

**æ¥å£åç§°**: ä¿®æ”¹ç”¨æˆ·å¯†ç 
**è¯·æ±‚æ–¹å¼**: POST
**è¯·æ±‚è·¯å¾„**: `/api/user/change-password`
**æ˜¯å¦éœ€è¦è®¤è¯**: æ˜¯

**è¯·æ±‚å‚æ•°** (Body - JSON):

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|-----|------|------|
| oldPassword | string | æ˜¯ | åŸå¯†ç  | "oldpass123" |
| newPassword | string | æ˜¯ | æ–°å¯†ç  | "newpass456" |
| confirmPassword | string | æ˜¯ | ç¡®è®¤æ–°å¯†ç  | "newpass456" |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "oldPassword": "oldpass123",
  "newPassword": "newpass456",
  "confirmPassword": "newpass456"
}
```

**å“åº”æ•°æ®** (æˆåŠŸ - HTTP 200):
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"
}
```

**å“åº”æ•°æ®** (å¤±è´¥):
```json
{
  "success": false,
  "error": "åŸå¯†ç é”™è¯¯",
  "code": "INVALID_OLD_PASSWORD"
}
```

**å‰ç«¯å¤‡æ³¨**:
- **è°ƒç”¨æ—¶æœº**: ç”¨æˆ·å¡«å†™å®Œå¯†ç è¡¨å•åç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"
- **æ•°æ®å¤„ç†**:
  1. å‰ç«¯éªŒè¯ï¼š
     - æ–°å¯†ç é•¿åº¦è‡³å°‘6ä½
     - æ–°å¯†ç ä¸ç¡®è®¤å¯†ç ä¸€è‡´
     - æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
  2. æˆåŠŸåæ¸…é™¤Tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
  3. æ˜¾ç¤ºæç¤ºï¼š"å¯†ç å·²ä¿®æ”¹ï¼Œè¯·é‡æ–°ç™»å½•"
- **LoadingçŠ¶æ€**: æŒ‰é’®æ˜¾ç¤º"ä¿®æ”¹ä¸­..."ï¼Œç¦ç”¨è¡¨å•
- **é”™è¯¯å¤„ç†**:
  - `INVALID_OLD_PASSWORD`: æç¤º"åŸå¯†ç é”™è¯¯"
  - `WEAK_PASSWORD`: æç¤º"å¯†ç å¼ºåº¦ä¸è¶³ï¼Œè‡³å°‘éœ€è¦6ä½å­—ç¬¦"

**åç«¯å®ç°è¦ç‚¹**:
- ä»Tokenè·å–user_id
- éªŒè¯æ—§å¯†ç ï¼ˆä½¿ç”¨bcryptæ¯”å¯¹ï¼‰
- éªŒè¯æ–°å¯†ç å¼ºåº¦ï¼ˆè‡³å°‘6ä½ï¼‰
- éªŒè¯æ–°å¯†ç ä¸ç¡®è®¤å¯†ç ä¸€è‡´
- ä½¿ç”¨bcryptåŠ å¯†æ–°å¯†ç 
- æ›´æ–°usersè¡¨çš„password_hashå­—æ®µ
- å°†å½“å‰TokenåŠ å…¥é»‘åå•ï¼ˆå¼ºåˆ¶é‡æ–°ç™»å½•ï¼‰
- è®°å½•activity_logsï¼ˆæ•æ„Ÿæ“ä½œï¼‰
- å¯é€‰ï¼šå‘é€é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·

---

## ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„

### 3.1 ç”¨æˆ·å¯¹è±¡ (User)

```typescript
interface User {
  id: number;                    // ç”¨æˆ·ID
  username: string;              // ç”¨æˆ·å
  email?: string;                // é‚®ç®±
  phone?: string;                // æ‰‹æœºå·
  realName?: string;             // çœŸå®å§“å
  role: string;                  // è§’è‰²: ç³»ç»Ÿç®¡ç†å‘˜/æ™®é€šç”¨æˆ·
  organization?: string;         // æ‰€å±ç»„ç»‡
  avatarUrl?: string;            // å¤´åƒURL
  loginCount?: number;           // ç™»å½•æ¬¡æ•°
  lastLoginTime?: string;        // æœ€åç™»å½•æ—¶é—´ (YYYY-MM-DD HH:mm:ss)
  createdAt?: string;            // åˆ›å»ºæ—¶é—´
}
```

---

### 3.2 è¯†åˆ«è®°å½•å¯¹è±¡ (RecognitionRecord)

```typescript
interface RecognitionRecord {
  id: number;                    // è®°å½•ID
  userId: number;                // ç”¨æˆ·ID
  plantId?: number;              // æ¤ç‰©ID
  plantName?: string;            // æ¤ç‰©åç§°
  imageUrl: string;              // å›¾åƒURL
  thumbnailUrl?: string;         // ç¼©ç•¥å›¾URL
  diseaseType: string;           // ç—…å®³ç±»å‹ä»£ç : powdery/downy/anthracnose/virus/aphid/healthy
  diseaseTypeName: string;       // ç—…å®³åç§°: ç™½ç²‰ç—…/éœœéœ‰ç—…ç­‰
  confidence: number;            // ç½®ä¿¡åº¦ (0-1)
  severity: string;              // ä¸¥é‡ç¨‹åº¦: è½»åº¦/ä¸­åº¦/é‡åº¦
  area?: string;                 // åŒºåŸŸ: ä¸œåŒº/è¥¿åŒº/å—åŒº/åŒ—åŒº/ä¸­å¿ƒåŒº
  droneId?: string;              // æ— äººæœºç¼–å·
  locationLat?: number;          // çº¬åº¦
  locationLng?: number;          // ç»åº¦
  status: string;                // å¤„ç†çŠ¶æ€: æœªå¤„ç†/å¤„ç†ä¸­/å·²å¤„ç†
  symptoms?: string;             // ç—‡çŠ¶æè¿°
  treatmentPlan?: string;        // å¤„ç†æ–¹æ¡ˆ
  identifyTime: string;          // è¯†åˆ«æ—¶é—´ (YYYY-MM-DD HH:mm:ss)
  rawPredictions?: {             // åŸå§‹é¢„æµ‹ç»“æœ
    [key: string]: number;       // å„ç±»åˆ«çš„ç½®ä¿¡åº¦
  };
}
```

---

### 3.3 æ— äººæœºçŠ¶æ€å¯¹è±¡ (DroneStatus)

```typescript
interface DroneStatus {
  droneId: string;               // æ— äººæœºç¼–å·
  droneName?: string;            // æ— äººæœºåç§°
  status: string;                // çŠ¶æ€: æ­£å¸¸/å¼‚å¸¸/ç»´æŠ¤/ç¦»çº¿
  battery: number;               // ç”µé‡ç™¾åˆ†æ¯” (0-100)
  range: number;                 // èˆªç¨‹ (ç±³)
  endurance: number;             // ç»­èˆªæ—¶é—´ (åˆ†é’Ÿ)
  locationLat?: number;          // å½“å‰çº¬åº¦
  locationLng?: number;          // å½“å‰ç»åº¦
  lastFlight?: string;           // æœ€åé£è¡Œæ—¶é—´
  updatedAt?: string;            // æ›´æ–°æ—¶é—´
}
```

---

### 3.4 å¤©æ°”ä¿¡æ¯å¯¹è±¡ (WeatherData)

```typescript
interface WeatherData {
  temperature: number;           // æ¸©åº¦ (â„ƒ)
  description: string;           // å¤©æ°”æè¿°: æ™´æœ—/å¤šäº‘/é›¨ç­‰
  humidity: number;              // æ¹¿åº¦ (%)
  windSpeed: number;             // é£é€Ÿ (m/s)
  pressure: number;              // æ°”å‹ (hPa)
  feelsLike?: number;            // ä½“æ„Ÿæ¸©åº¦ (â„ƒ)
  uvIndex?: number;              // ç´«å¤–çº¿æŒ‡æ•°
  forecast: WeatherForecast[];   // 7å¤©é¢„æŠ¥
}

interface WeatherForecast {
  day: string;                   // æ—¥æœŸ: ä»Šå¤©/æ˜å¤©/åå¤©/å‘¨X
  temp: number;                  // æ¸©åº¦
  desc: string;                  // å¤©æ°”æè¿°
  icon?: string;                 // å¤©æ°”å›¾æ ‡ (emojiæˆ–å›¾æ ‡åç§°)
}
```

---

### 3.5 æ´»åŠ¨æ—¥å¿—å¯¹è±¡ (ActivityLog)

```typescript
interface ActivityLog {
  id: number;                    // æ—¥å¿—ID
  type: string;                  // æ´»åŠ¨ç±»å‹: è¯†åˆ«/æ“ä½œ/æŸ¥çœ‹
  action: string;                // å…·ä½“åŠ¨ä½œæè¿°
  time: string;                  // æ—¶é—´ (YYYY-MM-DD HH:mm:ss)
  module?: string;               // åŠŸèƒ½æ¨¡å—
}
```

---

### 3.6 èŠå¤©æ¶ˆæ¯å¯¹è±¡ (ChatMessage)

```typescript
interface ChatMessage {
  id?: number;                   // æ¶ˆæ¯ID (å¯é€‰ï¼Œå‰ç«¯ä¸´æ—¶æ¶ˆæ¯å¯èƒ½æ²¡æœ‰)
  role: 'user' | 'assistant';    // è§’è‰²
  content: string;               // æ¶ˆæ¯å†…å®¹
  timestamp?: string;            // æ—¶é—´æˆ³
  isComplete?: boolean;          // æ˜¯å¦å®Œæ•´ (ç”¨äºæµå¼å“åº”)
}

interface ChatHistory {
  role: 'user' | 'assistant' | 'system';
  content: string;
}
```

---

### 3.7 å¯è§†åŒ–æ•°æ®å¯¹è±¡ (VisualizationData)

```typescript
interface VisualizationData {
  summary: {
    totalArea: number;           // ç›‘æµ‹æ€»é¢ç§¯ (äº©)
    healthRate: number;          // å¥åº·ç‡ (%)
    warningCount: number;        // è­¦å‘Šæ•°é‡
    totalRecognitions: number;   // æ€»è¯†åˆ«æ¬¡æ•°
  };
  diseaseDistribution: {         // ç—…è™«å®³åˆ†å¸ƒ
    labels: string[];            // ç—…å®³åç§°æ•°ç»„
    data: number[];              // å¯¹åº”æ•°é‡
    colors?: string[];           // å¯¹åº”é¢œè‰²
  };
  healthTrend: {                 // å¥åº·åº¦è¶‹åŠ¿
    labels: string[];            // æ—¥æœŸæ•°ç»„ (MM-DD)
    data: number[];              // å¥åº·ç‡æ•°ç»„
  };
  areaDistribution: {            // å„åŒºåŸŸç—…è™«å®³åˆ†å¸ƒ
    labels: string[];            // æ—¥æœŸæ•°ç»„
    datasets: {
      label: string;             // åŒºåŸŸåç§°
      data: number[];            // å„æ—¥æœŸçš„æ•°é‡
      backgroundColor: string;   // é¢œè‰²
    }[];
  };
  efficiencyStats: {             // è¯†åˆ«æ•ˆç‡ç»Ÿè®¡
    labels: string[];            // æ—¥æœŸæ•°ç»„
    recognitionCount: number[];  // è¯†åˆ«æ¬¡æ•°
    avgConfidence: number[];     // å¹³å‡ç½®ä¿¡åº¦
  };
  detailRecords: {               // è¯¦ç»†è®°å½•
    total: number;
    page: number;
    pageSize: number;
    records: RecognitionRecord[];
  };
}
```

---

### 3.8 åˆ†é¡µå¯¹è±¡ (Pagination)

```typescript
interface PaginationRequest {
  page: number;                  // é¡µç  (ä»1å¼€å§‹)
  pageSize: number;              // æ¯é¡µæ•°é‡
}

interface PaginationResponse<T> {
  total: number;                 // æ€»è®°å½•æ•°
  page: number;                  // å½“å‰é¡µç 
  pageSize: number;              // æ¯é¡µæ•°é‡
  totalPages: number;            // æ€»é¡µæ•°
  records: T[];                  // æ•°æ®æ•°ç»„
}
```

---

## å››ã€å¾…ç¡®è®¤ä¸æ³¨æ„äº‹é¡¹

### 4.1 å…³é”®ä¸šåŠ¡é—®é¢˜å¾…ç¡®è®¤

#### 4.1.1 åˆ†é¡µæ ¼å¼ç»Ÿä¸€

**é—®é¢˜**: æ‰€æœ‰åˆ†é¡µæ¥å£æ˜¯å¦ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼Ÿ

```json
{
  "total": 156,
  "page": 1,
  "pageSize": 10,
  "totalPages": 16,
  "records": [...]
}
```

**å»ºè®®**:
- âœ… é¡µç ä»1å¼€å§‹ï¼ˆä¸æ˜¯0ï¼‰
- âœ… è¿”å›totalPagesæ–¹ä¾¿å‰ç«¯è®¡ç®—
- âœ… æ•°ç»„å­—æ®µç»Ÿä¸€å‘½åä¸ºrecordsæˆ–data

---

#### 4.1.2 æ–‡ä»¶ä¸Šä¼ æ–¹å¼

**é—®é¢˜**: å›¾åƒä¸Šä¼ çš„è¯¦ç»†è§„èŒƒ

**å¾…ç¡®è®¤**:
1. æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼š
   - [ ] æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚`/var/www/uploads`ï¼‰
   - [ ] äº‘å­˜å‚¨ï¼ˆå¦‚é˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSï¼‰
2. æ–‡ä»¶è®¿é—®æ–¹å¼ï¼š
   - [ ] ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚`/uploads/recognition/2024/01/15/xxx.jpg`ï¼‰
   - [ ] å®Œæ•´URLï¼ˆå¦‚`https://cdn.scnai.com/uploads/xxx.jpg`ï¼‰
3. æ–‡ä»¶å‘½åè§„åˆ™ï¼š
   - å»ºè®®ï¼š`{timestamp}_{uuid}.{ext}`
   - ä¾‹å¦‚ï¼š`20240115_153045_a1b2c3d4.jpg`
4. æ˜¯å¦ç”Ÿæˆç¼©ç•¥å›¾ï¼š
   - å»ºè®®ç”Ÿæˆï¼ˆç”¨äºåˆ—è¡¨å±•ç¤ºï¼Œå‡å°‘å¸¦å®½ï¼‰
   - ç¼©ç•¥å›¾å°ºå¯¸ï¼š200x200æˆ–300x300
5. æ–‡ä»¶æ¸…ç†ç­–ç•¥ï¼š
   - æ˜¯å¦å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„æ–‡ä»¶
   - ä¿ç•™æ—¶é•¿ï¼šå»ºè®®è‡³å°‘30å¤©

---

#### 4.1.3 æ—¥æœŸæ—¶é—´æ ¼å¼

**é—®é¢˜**: å‰åç«¯äº¤äº’çš„æ—¥æœŸæ—¶é—´æ ¼å¼

**å¾…ç¡®è®¤**:
- æ—¥æœŸæ—¶é—´æ ¼å¼ï¼š`YYYY-MM-DD HH:mm:ss`ï¼ˆ24å°æ—¶åˆ¶ï¼‰
- æ—¶åŒºå¤„ç†ï¼š
  - [ ] åç«¯ç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´ï¼Œå‰ç«¯è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
  - [ ] åç«¯ç›´æ¥ä½¿ç”¨æœåŠ¡å™¨æ—¶åŒºï¼ˆå¦‚Asia/Shanghaiï¼‰
- å‰ç«¯å±•ç¤ºæ ¼å¼ï¼š
  - å®Œæ•´æ—¶é—´ï¼š`2024-01-15 14:30:25`
  - æ—¥æœŸï¼š`2024-01-15`
  - æ—¶é—´ï¼š`14:30`
  - ç›¸å¯¹æ—¶é—´ï¼šä»Šå¤©ã€æ˜¨å¤©ã€Xå¤©å‰

---

#### 4.1.4 ç—…è™«å®³ç±»å‹æ˜ å°„

**é—®é¢˜**: ç—…è™«å®³ç±»å‹çš„ä»£ç ä¸åç§°æ˜ å°„

**å¾…ç¡®è®¤**: åç«¯æ˜¯å¦ç»Ÿä¸€ç»´æŠ¤æ˜ å°„å…³ç³»ï¼Œè¿˜æ˜¯å‰ç«¯è‡ªè¡Œç»´æŠ¤ï¼Ÿ

**å»ºè®®æ˜ å°„è¡¨**:
```javascript
const DISEASE_TYPE_MAP = {
  'powdery': 'ç™½ç²‰ç—…',
  'downy': 'éœœéœ‰ç—…',
  'anthracnose': 'ç‚­ç–½ç—…',
  'virus': 'ç—…æ¯’ç—…',
  'aphid': 'èšœè™«',
  'healthy': 'å¥åº·'
};
```

**å»ºè®®**: åç«¯ç›´æ¥è¿”å›ä¸­æ–‡åç§°ï¼ˆdiseaseTypeNameï¼‰ï¼Œé¿å…å‰ç«¯ç»´æŠ¤æ˜ å°„è¡¨ã€‚

---

#### 4.1.5 ä¸¥é‡ç¨‹åº¦åˆ¤æ–­é€»è¾‘

**é—®é¢˜**: ä¸¥é‡ç¨‹åº¦çš„åˆ¤æ–­æ ‡å‡†

**å¾…ç¡®è®¤**: æ˜¯å¦æŒ‰ä»¥ä¸‹è§„åˆ™åˆ¤æ–­ï¼Ÿ
```
ç½®ä¿¡åº¦ > 0.8 ä¸”éhealthy â†’ é‡åº¦
0.5 < ç½®ä¿¡åº¦ <= 0.8 â†’ ä¸­åº¦
ç½®ä¿¡åº¦ <= 0.5 â†’ è½»åº¦
```

æˆ–è€…æ˜¯å¦æœ‰å…¶ä»–ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚ï¼šç»“åˆç—…å®³ç±»å‹ã€åŒºåŸŸã€å†å²æ•°æ®ç­‰ï¼‰ï¼Ÿ

---

#### 4.1.6 AIæ¨¡å‹ç›¸å…³

**é—®é¢˜**: AIè¯†åˆ«æ¨¡å‹çš„å…·ä½“å®ç°

**å¾…ç¡®è®¤**:
1. æ¨¡å‹ç±»å‹ï¼š
   - [ ] TensorFlow/Kerasæ¨¡å‹
   - [ ] PyTorchæ¨¡å‹
   - [ ] ONNXæ¨¡å‹
   - [ ] äº‘ç«¯APIï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘è§†è§‰è¯†åˆ«ï¼‰
2. æ¨¡å‹è¾“å…¥è¦æ±‚ï¼š
   - å›¾åƒå°ºå¯¸ï¼šå¦‚224x224ã€299x299
   - é¢œè‰²é€šé“ï¼šRGB
   - é¢„å¤„ç†ï¼šå½’ä¸€åŒ–ã€æ ‡å‡†åŒ–
3. æ¨¡å‹è¾“å‡ºï¼š
   - æ‰€æœ‰ç±»åˆ«çš„ç½®ä¿¡åº¦æ•°ç»„
   - è¿”å›Top-Kç»“æœè¿˜æ˜¯æ‰€æœ‰ç»“æœ
4. è¯†åˆ«æ€§èƒ½ï¼š
   - å¹³å‡æ¨ç†æ—¶é—´ï¼šé¢„æœŸ < 5ç§’
   - å¹¶å‘æ”¯æŒï¼šæ˜¯å¦éœ€è¦é˜Ÿåˆ—æœºåˆ¶
5. æ¨¡å‹æ›´æ–°ï¼š
   - æ¨¡å‹ç‰ˆæœ¬ç®¡ç†
   - å¦‚ä½•å¹³æ»‘åˆ‡æ¢æ¨¡å‹ç‰ˆæœ¬

---

#### 4.1.7 LLMæœåŠ¡é…ç½®

**é—®é¢˜**: æ™ºèƒ½é—®ç­”çš„LLMæœåŠ¡

**å¾…ç¡®è®¤**:
1. LLMæä¾›å•†ï¼š
   - [ ] OpenAI API (GPT-3.5/GPT-4)
   - [ ] DeepSeek API
   - [ ] æœ¬åœ°éƒ¨ç½²æ¨¡å‹ï¼ˆå¦‚LLaMAã€Qwenï¼‰
2. APIé…ç½®ï¼š
   - API Keyç®¡ç†ï¼ˆç¯å¢ƒå˜é‡ï¼‰
   - æ¨¡å‹é€‰æ‹©ï¼ˆgpt-3.5-turbo / deepseek-chatï¼‰
   - å‚æ•°è®¾ç½®ï¼ˆtemperature, max_tokensç­‰ï¼‰
3. ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰ï¼š
   ```
   ä½ æ˜¯SCNAIæ¤ç‰©ç—…è™«å®³æ™ºèƒ½è¯†åˆ«ç³»ç»Ÿçš„ä¸“ä¸šåŠ©æ‰‹ï¼Œä¸“æ³¨äºï¼š
   1. æ¤ç‰©ç—…è™«å®³è¯†åˆ«ä¸è¯Šæ–­
   2. é˜²æ²»æ–¹æ³•å»ºè®®
   3. æ ½åŸ¹ç®¡ç†æŒ‡å¯¼
   4. å†œä¸šçŸ¥è¯†é—®ç­”

   è¯·ç”¨ä¸“ä¸šã€å‡†ç¡®ã€æ˜“æ‡‚çš„è¯­è¨€å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
   å›ç­”è¦ç»“æ„åŒ–ï¼Œä½¿ç”¨åˆ†ç‚¹åˆ—è¡¨ï¼Œçªå‡ºå…³é”®ä¿¡æ¯ã€‚
   ```
4. ä¸Šä¸‹æ–‡ç®¡ç†ï¼š
   - ä¿ç•™å¤šå°‘è½®å¯¹è¯å†å²ï¼ˆå»ºè®®5-10è½®ï¼‰
   - æ˜¯å¦éœ€è¦å¯¹è¯æ‘˜è¦ï¼ˆé•¿å¯¹è¯å‹ç¼©ï¼‰
5. æµå¼å“åº”ï¼š
   - ç¡®è®¤åç«¯æ”¯æŒSSE
   - chunkå¤§å°ï¼ˆå»ºè®®æŒ‰è¯æˆ–çŸ­è¯­åˆ†å‰²ï¼‰

---

#### 4.1.8 æƒé™ä¸å®‰å…¨

**é—®é¢˜**: æƒé™æ§åˆ¶å’Œå®‰å…¨æªæ–½

**å¾…ç¡®è®¤**:
1. Tokenæœ‰æ•ˆæœŸï¼š
   - remember=true: 7å¤©
   - remember=false: 1å¤©
   - æ˜¯å¦æ”¯æŒåˆ·æ–°Tokenæœºåˆ¶
2. å¯†ç ç­–ç•¥ï¼š
   - æœ€å°é•¿åº¦ï¼š6ä½ï¼ˆå»ºè®®8ä½ï¼‰
   - æ˜¯å¦è¦æ±‚å¤æ‚åº¦ï¼ˆå¤§å°å†™ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
   - æ˜¯å¦é™åˆ¶å¸¸è§å¼±å¯†ç 
3. è¯·æ±‚é™æµï¼š
   - æ˜¯å¦å®ç°APIé™æµï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ã€DDoSï¼‰
   - é™æµè§„åˆ™ï¼šå¦‚æ¯åˆ†é’Ÿæœ€å¤š100æ¬¡è¯·æ±‚
4. æ–‡ä»¶ä¸Šä¼ å®‰å…¨ï¼š
   - æ˜¯å¦æ£€æŸ¥æ–‡ä»¶çœŸå®ç±»å‹ï¼ˆä¸ä»…çœ‹æ‰©å±•åï¼‰
   - æ˜¯å¦æ‰«ææ¶æ„æ–‡ä»¶
   - æ˜¯å¦é™åˆ¶ä¸Šä¼ é¢‘ç‡
5. SQLæ³¨å…¥é˜²æŠ¤ï¼š
   - ä½¿ç”¨Prepared Statement
   - å‚æ•°åŒ–æŸ¥è¯¢
6. XSSé˜²æŠ¤ï¼š
   - åç«¯è¿”å›çš„æ–‡æœ¬å†…å®¹æ˜¯å¦éœ€è¦è½¬ä¹‰
   - å‰ç«¯å±•ç¤ºç”¨æˆ·è¾“å…¥å†…å®¹æ—¶éœ€è¦sanitize

---

### 4.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 4.2.1 æ•°æ®åº“ä¼˜åŒ–

**å¿…é¡»æ·»åŠ çš„ç´¢å¼•**:
```sql
-- recognition_recordsè¡¨
CREATE INDEX idx_user_time ON recognition_records(user_id, identify_time);
CREATE INDEX idx_area_time ON recognition_records(area, identify_time);
CREATE INDEX idx_disease_time ON recognition_records(disease_type, identify_time);
CREATE INDEX idx_severity ON recognition_records(severity);

-- activity_logsè¡¨
CREATE INDEX idx_user_time ON activity_logs(user_id, created_at);

-- chat_historyè¡¨
CREATE INDEX idx_user_session ON chat_history(user_id, session_id);
```

**æŸ¥è¯¢ä¼˜åŒ–**:
- å¯è§†åŒ–æ•°æ®èšåˆæŸ¥è¯¢è¾ƒé‡ï¼Œå»ºè®®ï¼š
  - ä½¿ç”¨Redisç¼“å­˜ï¼ˆ5-15åˆ†é’Ÿè¿‡æœŸï¼‰
  - å¯¹äºå†å²æ•°æ®ï¼Œè€ƒè™‘é¢„èšåˆï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
  - ä½¿ç”¨åˆ†åŒºè¡¨ï¼ˆæŒ‰æœˆåˆ†åŒºï¼‰

---

#### 4.2.2 ç¼“å­˜ç­–ç•¥

**å»ºè®®ä½¿ç”¨Redisç¼“å­˜**:
1. **ç”¨æˆ·ä¿¡æ¯**: `user:{user_id}` â†’ 1å°æ—¶è¿‡æœŸ
2. **å¤©æ°”æ•°æ®**: `weather:{area}` â†’ 15åˆ†é’Ÿè¿‡æœŸ
3. **æ— äººæœºçŠ¶æ€**: `drone:status:{drone_id}` â†’ 5åˆ†é’Ÿè¿‡æœŸ
4. **å¯è§†åŒ–æ•°æ®**: `visualization:{timeRange}:{area}:{diseaseType}` â†’ 10åˆ†é’Ÿè¿‡æœŸ
5. **Tokené»‘åå•**: `token:blacklist:{token}` â†’ Tokenå‰©ä½™æœ‰æ•ˆæœŸ

---

#### 4.2.3 å¹¶å‘å¤„ç†

**å›¾åƒè¯†åˆ«**:
- ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Redis Queueï¼‰
- è¯†åˆ«è¯·æ±‚è¿›å…¥é˜Ÿåˆ—ï¼Œworkerå¼‚æ­¥å¤„ç†
- è¿”å›ä»»åŠ¡IDï¼Œå‰ç«¯è½®è¯¢æˆ–WebSocketé€šçŸ¥ç»“æœ

**LLMé—®ç­”**:
- é™åˆ¶æ¯ä¸ªç”¨æˆ·çš„å¹¶å‘è¯·æ±‚æ•°ï¼ˆå¦‚1ä¸ªï¼‰
- å®ç°è¯·æ±‚é˜Ÿåˆ—ï¼ˆé«˜å¹¶å‘æ—¶æ’é˜Ÿï¼‰
- è®¾ç½®åˆç†è¶…æ—¶ï¼ˆ120ç§’ï¼‰

---

### 4.3 é”™è¯¯å¤„ç†è§„èŒƒ

#### 4.3.1 HTTPçŠ¶æ€ç ä½¿ç”¨

| åœºæ™¯ | çŠ¶æ€ç  | è¯´æ˜ |
|------|-------|------|
| æˆåŠŸ | 200 | è¯·æ±‚æˆåŠŸ |
| åˆ›å»ºæˆåŠŸ | 201 | èµ„æºåˆ›å»ºæˆåŠŸ |
| å‚æ•°é”™è¯¯ | 400 | è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥ |
| æœªè®¤è¯ | 401 | Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ |
| æ— æƒé™ | 403 | æƒé™ä¸è¶³ |
| èµ„æºä¸å­˜åœ¨ | 404 | è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ |
| æœåŠ¡å™¨é”™è¯¯ | 500 | å†…éƒ¨é”™è¯¯ |

#### 4.3.2 é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€

```json
{
  "success": false,
  "error": "ç”¨æˆ·å¯è¯»çš„é”™è¯¯ä¿¡æ¯",
  "code": "ERROR_CODE",
  "details": {
    "field": "password",
    "message": "å¯†ç é•¿åº¦è‡³å°‘6ä½"
  }
}
```

---

### 4.4 å¼€å‘å‰éœ€ç¡®è®¤æ¸…å•

**åç«¯å¼€å‘å‰å¿…é¡»ç¡®è®¤**:
- [ ] æ•°æ®åº“è¡¨ç»“æ„å·²reviewå¹¶ç¡®è®¤
- [ ] JWT Secretå·²ç”Ÿæˆï¼ˆå¼ºå¯†ç ï¼‰
- [ ] æ–‡ä»¶å­˜å‚¨è·¯å¾„å·²è§„åˆ’
- [ ] LLM API Keyå·²ç”³è¯·
- [ ] æ˜¯å¦éœ€è¦ç¬¬ä¸‰æ–¹å¤©æ°”API
- [ ] AIè¯†åˆ«æ¨¡å‹å·²è®­ç»ƒå¹¶å¯ç”¨
- [ ] å¼€å‘ç¯å¢ƒæ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] æµ‹è¯•ç”¨æˆ·è´¦å·å·²åˆ›å»º

**å‰ç«¯å¼€å‘å‰å¿…é¡»ç¡®è®¤**:
- [ ] åç«¯Base URLå·²ç¡®å®š
- [ ] æ¥å£æ–‡æ¡£å·²review
- [ ] é”™è¯¯ç åˆ—è¡¨å·²åŒæ­¥
- [ ] æ—¥æœŸæ—¶é—´æ ¼å¼å·²ç»Ÿä¸€
- [ ] ç—…è™«å®³ç±»å‹æ˜ å°„å·²ç¡®è®¤
- [ ] æ˜¯å¦éœ€è¦mockæ•°æ®ï¼ˆåç«¯æœªreadyæ—¶ï¼‰

**è”è°ƒå‰å¿…é¡»ç¡®è®¤**:
- [ ] CORSè·¨åŸŸé…ç½®å·²æ·»åŠ 
- [ ] å‰ç«¯ä»£ç†é…ç½®å·²æ­£ç¡®
- [ ] Tokenä¼ é€’æ–¹å¼å·²æµ‹è¯•
- [ ] æ–‡ä»¶ä¸Šä¼ æ¥å£å·²æµ‹è¯•
- [ ] SSEæµå¼å“åº”å·²æµ‹è¯•

---

### 4.5 æµ‹è¯•å»ºè®®

#### 4.5.1 æ¥å£æµ‹è¯•å·¥å…·

**æ¨èå·¥å…·**:
- Postman / Apifoxï¼ˆæ¥å£è°ƒè¯•ï¼‰
- curlï¼ˆå‘½ä»¤è¡Œå¿«é€Ÿæµ‹è¯•ï¼‰
- å‰ç«¯MockæœåŠ¡ï¼ˆå¦‚Mock.jsï¼‰

**æµ‹è¯•ç”¨ä¾‹**:
- æ­£å¸¸æµç¨‹æµ‹è¯•
- è¾¹ç•Œå€¼æµ‹è¯•ï¼ˆå¦‚pageSize=0, confidence=1.0ï¼‰
- å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼ˆå¦‚Tokenè¿‡æœŸã€æ–‡ä»¶è¿‡å¤§ï¼‰
- å¹¶å‘æµ‹è¯•ï¼ˆå¦‚å¤šç”¨æˆ·åŒæ—¶è¯†åˆ«ï¼‰

#### 4.5.2 å‰ç«¯æµ‹è¯•

**å¿…é¡»æµ‹è¯•çš„åœºæ™¯**:
1. Tokenè¿‡æœŸæ—¶çš„å¤„ç†ï¼ˆ401è‡ªåŠ¨è·³è½¬ç™»å½•ï¼‰
2. ç½‘ç»œæ–­å¼€æ—¶çš„é”™è¯¯æç¤º
3. å›¾åƒä¸Šä¼ çš„å„ç§æƒ…å†µï¼ˆæ ¼å¼ã€å¤§å°ã€ç½‘ç»œæ…¢ï¼‰
4. SSEè¿æ¥ä¸­æ–­çš„å¤„ç†
5. é•¿æ—¶é—´æ“ä½œçš„è¶…æ—¶å¤„ç†

---

### 4.6 éƒ¨ç½²æ³¨æ„äº‹é¡¹

#### 4.6.1 ç¯å¢ƒå˜é‡é…ç½®

**å¿…é¡»é…ç½®çš„ç¯å¢ƒå˜é‡**:
```bash
# åº”ç”¨é…ç½®
APP_ENV=production
APP_PORT=5000
JWT_SECRET=your-super-secret-key-change-in-production

# æ•°æ®åº“
DB_HOST=localhost
DB_PORT=3306
DB_NAME=scnai_plant
DB_USER=root
DB_PASSWORD=your-db-password

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# æ–‡ä»¶å­˜å‚¨
UPLOAD_FOLDER=/var/www/scnai/uploads
MAX_FILE_SIZE=3145728

# AIæœåŠ¡
OPENAI_API_KEY=sk-xxxxx
MODEL_PATH=/var/www/scnai/models/disease_model.h5

# å¤©æ°”API
WEATHER_API_KEY=your-weather-api-key
```

#### 4.6.2 Nginxé…ç½®

**å‰ç«¯é™æ€æ–‡ä»¶ + åç«¯åå‘ä»£ç†**:
```nginx
server {
    listen 80;
    server_name scnai.example.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/scnai/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # SSEç‰¹æ®Šé…ç½®
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 120s;
    }

    # ä¸Šä¼ æ–‡ä»¶è®¿é—®
    location /uploads/ {
        alias /var/www/scnai/uploads/;
        expires 30d;
    }
}
```

---

## äº”ã€é™„å½•

### 5.1 å¿«é€Ÿå¼€å§‹æŒ‡å—

#### å‰ç«¯å¼€å‘
```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ä»£ç†ï¼ˆvite.config.jså·²é…ç½®ï¼‰
# ç¡®ä¿åç«¯è¿è¡Œåœ¨ http://localhost:5000

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. è®¿é—®
# http://localhost:3000
```

#### åç«¯å¼€å‘ï¼ˆä»¥Java/Spring Bootä¸ºä¾‹ï¼‰
```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p < database_schema.sql

# 2. é…ç½®application.yml
# è®¾ç½®æ•°æ®åº“è¿æ¥ã€JWT Secretç­‰

# 3. å¯åŠ¨åº”ç”¨
mvn spring-boot:run

# 4. æµ‹è¯•æ¥å£
curl http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123"}'
```

---

### 5.2 å¸¸è§é—®é¢˜FAQ

**Q1: Tokenè¿‡æœŸåå‰ç«¯å¦‚ä½•å¤„ç†ï¼Ÿ**
A: åœ¨Axioså“åº”æ‹¦æˆªå™¨ä¸­æ•è·401é”™è¯¯ï¼Œæ¸…é™¤localStorageï¼Œè·³è½¬åˆ°ç™»å½•é¡µã€‚

**Q2: å›¾åƒè¯†åˆ«è¶…æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ**
A: å‰ç«¯è®¾ç½®60ç§’è¶…æ—¶ï¼Œè¶…æ—¶åæç¤ºç”¨æˆ·é‡è¯•ã€‚åç«¯ä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†ï¼Œé¿å…é˜»å¡ã€‚

**Q3: SSEè¿æ¥æ–­å¼€å¦‚ä½•é‡è¿ï¼Ÿ**
A: å‰ç«¯æ£€æµ‹erroräº‹ä»¶æˆ–è¿æ¥å…³é—­ï¼Œæç¤ºç”¨æˆ·é‡è¯•ã€‚æš‚ä¸å®ç°è‡ªåŠ¨é‡è¿ï¼ˆé¿å…å¾ªç¯è¯·æ±‚ï¼‰ã€‚

**Q4: å¦‚ä½•mockåç«¯æ¥å£ï¼Ÿ**
A: ä½¿ç”¨Mock.jsæˆ–Apifoxçš„MockæœåŠ¡ï¼Œæˆ–åœ¨å‰ç«¯åˆ›å»ºmockæ•°æ®æ–‡ä»¶ã€‚

**Q5: å¦‚ä½•è°ƒè¯•SSEæµå¼å“åº”ï¼Ÿ**
A: ä½¿ç”¨curlå‘½ä»¤ï¼š`curl -N http://localhost:5000/api/chat/stream -H "Authorization: Bearer token" -d '{"message":"test"}'`

---

### 5.3 å‚è€ƒèµ„æº

- **JWT**: https://jwt.io/
- **Chart.jsæ–‡æ¡£**: https://www.chartjs.org/docs/latest/
- **SSEè§„èŒƒ**: https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events
- **OpenAI API**: https://platform.openai.com/docs/api-reference
- **DeepSeek API**: https://platform.deepseek.com/api-docs
- **Spring Bootæ–‡ä»¶ä¸Šä¼ **: https://spring.io/guides/gs/uploading-files/
- **Axiosæ–‡æ¡£**: https://axios-http.com/docs/intro

---

## ğŸ“ æ–‡æ¡£æ›´æ–°è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹äºº |
|-----|------|---------|-------|
| v1.0 | 2024-01-16 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´æ¥å£å®šä¹‰ | - |

---

**æ–‡æ¡£ç»“æŸ**

> å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦è¡¥å……ï¼Œè¯·åŠæ—¶è”ç³»å‰åç«¯å›¢é˜Ÿè¿›è¡Œç¡®è®¤ã€‚
